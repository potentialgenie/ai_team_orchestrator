<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Isolating Intelligence - The LLM Mock Strategy | Core Philosophy and Architecture | AI Team Orchestrator</title>
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="How to effectively test non-deterministic AI systems. Mocking strategies that actually work in production.">
    <meta name="keywords" content="AI testing, LLM mocking, non-deterministic testing, AI system testing, production testing">
    <meta name="author" content="Daniele Pelleri">
    <meta name="robots" content="index, follow">
    
    <!-- Open Graph -->
    <meta property="og:title" content="Isolating Intelligence - The LLM Mock Strategy - Chapter 3">
    <meta property="og:description" content="Learn how to effectively test non-deterministic AI systems with practical mocking strategies">
    <meta property="og:type" content="article">
    <meta property="og:url" content="https://books.danielepelleri.com/en/core-philosophy-architecture/ai-mocking-testing-strategy/">
    <meta property="article:author" content="Daniele Pelleri">
    <meta property="article:section" content="AI Testing">
    <meta property="article:tag" content="AI Testing, LLM Mocking, Non-deterministic Testing">
    
    <!-- Canonical -->
    <link rel="canonical" href="https://books.danielepelleri.com/en/core-philosophy-architecture/ai-mocking-testing-strategy/">
    <link rel="alternate" hreflang="en" href="https://books.danielepelleri.com/en/core-philosophy-architecture/ai-mocking-testing-strategy/">
    <link rel="alternate" hreflang="it" href="https://books.danielepelleri.com/it/filosofia-core-architettura/isolare-intelligenza-mock-llm/">
    
    <!-- Schema Markup -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Article",
      "headline": "Isolating Intelligence - The LLM Mock Strategy",
      "description": "How to effectively test non-deterministic AI systems with practical mocking strategies",
      "author": {
        "@type": "Person",
        "name": "Daniele Pelleri",
        "url": "https://danielepelleri.com"
      },
      "publisher": {
        "@type": "Person", 
        "name": "Daniele Pelleri"
      },
      "datePublished": "2025",
      "dateModified": "2025",
      "url": "https://books.danielepelleri.com/en/core-philosophy-architecture/ai-mocking-testing-strategy/",
      "isPartOf": {
        "@type": "Book",
        "name": "AI Team Orchestrator: From MVP to Global Platform",
        "author": "Daniele Pelleri",
        "url": "https://books.danielepelleri.cai-team-orchestrator.html"
      },
      "articleSection": "Core Philosophy and Architecture",
      "wordCount": "1800",
      "timeRequired": "PT18M",
      "keywords": ["AI testing", "LLM mocking", "non-deterministic testing", "production testing"],
      "about": {
        "@type": "Thing",
        "name": "AI Testing and Mocking Strategies"
    }
   
    
        }
    </script>
    
    <style>
        /* Same base styles as previous chapters */;
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; line-height: 1.6; color: #2c3e50; background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); min-height: 100vh; }
        .container { max-width: 900px; margin: 0 auto; padding: 2rem; }
        .breadcrumb { background: rgba(255, 255, 255, 0.9); padding: 1rem 2rem; border-radius: 10px; margin-bottom: 2rem; font-size: 0.9rem; backdrop-filter: blur(10px); }
        .breadcrumb a { color: #667eea; text-decoration: none; }
        .breadcrumb a:hover { text-decoration: underline; }
        .breadcrumb span { color: #7f8c8d; margin: 0 0.5rem; }
        .chapter-header { background: white; padding: 3rem; border-radius: 20px; box-shadow: 0 15px 35px rgba(0,0,0,0.1); margin-bottom: 3rem; text-align: center; }
        .chapter-instrument { font-size: 4rem; margin-bottom: 1rem; }
        .chapter-meta { display: flex; justify-content: center; gap: 2rem; margin-bottom: 1rem; font-size: 0.9rem; color: #7f8c8d; flex-wrap: wrap; }
        .chapter-title { font-size: 2.5rem; color: #2c3e50; margin-bottom: 1rem; font-weight: 700; line-height: 1.2; }
        .chapter-summary { font-size: 1.2rem; color: #555; max-width: 700px; margin: 2rem auto; font-style: italic; }
        .nav-button { display: inline-flex; align-items: center; gap: 0.5rem; padding: 1rem 2rem; background: linear-gradient(135deg, #667eea, #764ba2); color: white; text-decoration: none; border-radius: 50px; font-weight: 600; transition: all 0.3s ease; box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4); }
        .nav-button:hover { transform: translateY(-3px); box-shadow: 0 15px 40px rgba(102, 126, 234, 0.6); }
        .nav-button.secondary { background: rgba(255, 255, 255, 0.9); color: #667eea; border: 2px solid #667eea; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        .nav-button.secondary:hover { background: white; box-shadow: 0 15px 40px rgba(0,0,0,0.15); }
        .chapter-nav-bottom { display: flex; justify-content: space-between; align-items: center; margin: 3rem 0; gap: 1rem; flex-wrap: wrap; }
        /* Chapter Content Styles */
        .chapter-content {
            background: white;
            padding: 3rem;
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            margin-bottom: 3rem;
            line-height: 1.8;
        }
        
        .chapter-content h3, .chapter-content h4, .chapter-content h5 {
            color: #2c3e50;
            margin: 2rem 0 1rem 0;
            border-left: 4px solid #667eea;
            padding-left: 1.5rem;
        }
        
        .chapter-content h5 {
            font-size: 1.2rem;
            margin: 1.5rem 0 1rem 0;
        }
        
        .chapter-content p {
            margin-bottom: 1.5rem;
        }
        
        .chapter-content ol, .chapter-content ul {
            margin: 1rem 0 1.5rem 2rem;
        }
        
        .chapter-content li {
            margin-bottom: 0.5rem;
        }
        
        .mermaid-container {
            background: #f8f9fa;
            padding: 2rem;
            border-radius: 10px;
            margin: 2rem 0;
            text-align: center;
        }
        
        .mermaid-container h4 {
            color: #2c3e50;
            margin-bottom: 1.5rem;
            border: none;
            padding: 0;
        }
        
        .war-story {
            background: linear-gradient(135deg, #fff3cd, #ffeaa7);
            border-left: 4px solid #856404;
            border-radius: 10px;
            padding: 2rem;
            margin: 2rem 0;
        }
        
        .war-story-header h4 {
            color: #856404;
            margin-bottom: 1rem;
            border: none;
            padding: 0;
        }
        
        .war-story-content {
            color: #6c757d;
        }
        
        .key-takeaways {
            background: linear-gradient(135deg, #d4edda, #c3e6cb);
            border-left: 4px solid #28a745;
            border-radius: 10px;
            padding: 2rem;
            margin: 2rem 0;
        }
        
        .key-takeaways h4 {
            color: #155724;
            margin-bottom: 1rem;
            border: none;
            padding: 0;
        }
        
        .key-takeaways p {
            color: #155724;
        }
        
        pre {
            background: #2d3748;
            color: #e2e8f0;
            padding: 1.5rem;
            border-radius: 8px;
            overflow-x: auto;
            margin: 1.5rem 0;
            font-size: 0.9rem;
        }
        
        code {
            background: #f1f3f4;
            color: #d73a49;
            padding: 0.2rem 0.4rem;
            border-radius: 3px;
            font-family: Monaco, Menlo, Ubuntu Mono, monospace;
        }
        
        pre code {
            background: transparent;
            color: inherit;
            padding: 0;
        }
        
        @media (max-width: 768px) { 
            .container { 
                padding: 1rem; 
            } 
            .chapter-header { 
                padding: 2rem; 
            } 
            .chapter-title { 
                font-size: 2rem; 
            }
            .chapter-content {
                padding: 1.5rem;
            }
            .chapter-content h3, .chapter-content h4, .chapter-content h5 {
                font-size: 1.3rem;
            }
            .war-story, .key-takeaways, .mermaid-container {
                padding: 1.5rem;
            }
            .chapter-nav-bottom { 
                flex-direction: column; 
                text-align: center; 
            } 
        }
        /* Reader Tools */
        .reader-tools {
            position: fixed;
            top: 50%;
            right: 20px;
            transform: translateY(-50%);
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 1rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 0.8rem;
            transition: all 0.3s ease;
            min-width: 60px;
        }
        
        .reader-tools.collapsed {
            width: 60px;
            padding: 0.8rem;
        }
        
        .reader-tool {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.6rem;
            border: none;
            background: transparent;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.2s ease;
            color: #495057;
            font-size: 0.85rem;
            white-space: nowrap;
        }
        
        .reader-tool:hover {
            background: rgba(102, 126, 234, 0.1);
            color: #667eea;
        }
        
        .reader-tool.active {
            background: #667eea;
            color: white;
        }
        
        .reader-tool-icon {
            font-size: 1.1rem;
            flex-shrink: 0;
        }
        
        .reader-tool-label {
            font-size: 0.8rem;
            font-weight: 500;
        }
        
        .collapsed .reader-tool-label {
            display: none;
        }
        
        .reader-tools-toggle {
            position: absolute;
            top: -10px;
            left: -10px;
            width: 30px;
            height: 30px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }
        
        /* Language Switcher */
        .language-switcher {
            position: relative;
        }
        
        .language-select {
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid rgba(0,0,0,0.1);
            border-radius: 6px;
            padding: 0.4rem 0.8rem;
            font-size: 0.75rem;
            font-weight: 600;
            color: #495057;
            cursor: pointer;
            transition: all 0.2s ease;
            appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns=http://www.w3.org/2000/svg' viewBox=0 0 24 24 fill=none stroke=currentColor' stroke-width=2 stroke-linecap=round stroke-linejoin=round%3e%3cpolyline points=6,9 12,15 18,9%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 0.4rem center;
            background-size: 1rem;
            padding-right: 1.8rem;
            min-width: 60px;
        }
        
        .language-select:hover {
            background: rgba(255, 255, 255, 1);
            border-color: #667eea;
        }
        
        .language-select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.2);
        }
        
        /* Reading Progress */
        .reading-progress {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background: rgba(102, 126, 234, 0.2);
            z-index: 1001;
        }
        
        .reading-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            width: 0%;
            transition: width 0.3s ease;
        }
        
        /* Dark Mode */
        body.dark-mode {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #e9ecef;
        }
        
        .dark-mode .container {
            color: #e9ecef;
        }
        
        .dark-mode .chapter-header,
        .dark-mode .chapter-content {
            background: rgba(255, 255, 255, 0.05);
            color: #e9ecef;
        }
        
        .dark-mode .breadcrumb {
            background: rgba(255, 255, 255, 0.1);
            color: #e9ecef;
        }
        
        .dark-mode .reader-tools {
            background: rgba(0, 0, 0, 0.8);
            color: #e9ecef;
        }
        
        .dark-mode .reader-tool {
            color: #e9ecef;
        }
        
        .dark-mode .reader-tool:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .dark-mode .language-select {
            background: rgba(255, 255, 255, 0.1);
            color: #e9ecef;
            border-color: rgba(255, 255, 255, 0.2);
        }
        
        .dark-mode .language-select:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: #667eea;
        }
        
        /* Dark Mode - Headings and Titles */
        .dark-mode .chapter-title,
        .dark-mode .chapter-content h3,
        .dark-mode .chapter-content h4,
        .dark-mode .chapter-content h5 {
            color: #e9ecef !important;
        }
        
        .dark-mode .chapter-content p,
        .dark-mode .chapter-content li,
        .dark-mode .chapter-content strong {
            color: #e9ecef;
        }
        
        .dark-mode .takeaway-item {
            color: #e9ecef;
        }
        
        /* Navigation Container Fix */
        .chapter-nav-bottom {
            max-width: 100%;
            box-sizing: border-box;
            padding: 0 1rem;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .reader-tools {
                right: 10px;
                padding: 0.8rem;
                min-width: 50px;
            }
            
            .reader-tools.collapsed {
                width: 50px;
                padding: 0.6rem;
            }
            
            .reader-tool {
                padding: 0.5rem;
            }
            
            .reader-tool-label {
                font-size: 0.75rem;
            }
        }

        /* Fixed Bookmark Toast */
        .bookmark-toast {
            position: fixed;
            top: 80px;
            right: 20px;
            background: #28a745;
            color: white;
            padding: 0.8rem 1.2rem;
            border-radius: 8px;
            z-index: 1002;
            transform: translateX(350px);
            opacity: 0;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            box-shadow: 0 5px 15px rgba(40, 167, 69, 0.3);
            pointer-events: none;
        }
        
        .bookmark-toast.show {
            transform: translateX(0);
            opacity: 1;
            pointer-events: auto;
        }
        
        .bookmark-toast.error {
            background: #dc3545;
            box-shadow: 0 5px 15px rgba(220, 53, 69, 0.3);
        }

        /* Bookmarks Modal */
        .bookmarks-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            display: none;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(5px);
        }
        
        .bookmarks-modal.show {
            display: flex;
        }
        
        .bookmarks-content {
            background: white;
            border-radius: 20px;
            padding: 2rem;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            position: relative;
        }
        
        .bookmarks-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid #f8f9fa;
        }
        
        .bookmarks-title {
            font-size: 1.5rem;
            color: #2c3e50;
            margin: 0;
        }
        
        .bookmarks-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #7f8c8d;
            padding: 0.5rem;
            border-radius: 50%;
            transition: all 0.2s ease;
        }
        
        .bookmarks-close:hover {
            background: #f8f9fa;
            color: #2c3e50;
        }
        
        .bookmark-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            margin-bottom: 1rem;
            background: #f8f9fa;
            border-radius: 10px;
            transition: all 0.2s ease;
        }
        
        .bookmark-item:hover {
            background: #e9ecef;
        }
        
        .bookmark-info {
            flex: 1;
        }
        
        .bookmark-title {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 0.25rem;
            font-size: 1rem;
        }
        
        .bookmark-url {
            font-size: 0.8rem;
            color: #667eea;
            text-decoration: none;
        }
        
        .bookmark-url:hover {
            text-decoration: underline;
        }
        
        .bookmark-date {
            font-size: 0.75rem;
            color: #7f8c8d;
            margin-top: 0.25rem;
        }
        
        .bookmark-actions {
            display: flex;
            gap: 0.5rem;
        }
        
        .bookmark-action {
            background: none;
            border: none;
            padding: 0.5rem;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 1rem;
        }
        
        .bookmark-action:hover {
            background: rgba(102, 126, 234, 0.1);
        }
        
        .bookmark-action.delete:hover {
            background: rgba(220, 53, 69, 0.1);
            color: #dc3545;
        }
        
        .no-bookmarks {
            text-align: center;
            padding: 3rem 2rem;
            color: #7f8c8d;
        }
        
        .no-bookmarks-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }
        
        /* Dark Mode for Bookmarks Modal */
        .dark-mode .bookmarks-content {
            background: rgba(26, 26, 46, 0.95);
            color: #e9ecef;
        }
        
        .dark-mode .bookmarks-title {
            color: #e9ecef;
        }
        
        .dark-mode .bookmarks-close {
            color: #e9ecef;
        }
        
        .dark-mode .bookmarks-close:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .dark-mode .bookmark-item {
            background: rgba(255, 255, 255, 0.05);
        }
        
        .dark-mode .bookmark-item:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .dark-mode .bookmark-title {
            color: #e9ecef;
        }

        /* Architecture Section Icons and Headers */
        .architecture-title {
            background: #495057;
            color: white;
            padding: 1rem 1.5rem;
            margin: -2rem -2rem 1.5rem -2rem;
            border-radius: 10px 10px 0 0;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .architecture-icon {
            width: 24px;
            height: 24px;
            flex-shrink: 0;
        }

        .architecture-title h4 {
            margin: 0;
            font-size: 1.1rem;
            font-weight: 600;
        }

        .war-story-header {
            background: #856404;
            color: white;
            padding: 1rem 1.5rem;
            margin: -2rem -2rem 1.5rem -2rem;
            border-radius: 10px 10px 0 0;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .war-story-icon {
            width: 24px;
            height: 24px;
            flex-shrink: 0;
        }

        .war-story-header h4 {
            margin: 0;
            font-size: 1.1rem;
            font-weight: 600;
        }

        .insight-header {
            background: #28a745;
            color: white;
            padding: 1rem 1.5rem;
            margin: -2rem -2rem 1.5rem -2rem;
            border-radius: 10px 10px 0 0;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .insight-icon {
            width: 24px;
            height: 24px;
            flex-shrink: 0;
        }

        .insight-header h4 {
            margin: 0;
            font-size: 1.1rem;
            font-weight: 600;
        }

        /* Dark Mode - Content Areas */
        .dark-mode .content-area {
            background: rgba(255, 255, 255, 0.05);
            color: #e9ecef;
        }
        
        .dark-mode .content-area h2,
        .dark-mode .content-area h3,
        .dark-mode .content-area h4 {
            color: #e9ecef;
        }
        
        .dark-mode .content-area p,
        .dark-mode .content-area li {
            color: #e9ecef;
        }
        
        .dark-mode .content-area strong {
            color: #e9ecef;
        }
        
        /* Dark Mode - Tables */
        .dark-mode table {
            background: rgba(255, 255, 255, 0.05);
        }
        
        .dark-mode th,
        .dark-mode td {
            color: #e9ecef;
            border-bottom-color: rgba(255, 255, 255, 0.1);
        }
        
        .dark-mode th {
            background: rgba(255, 255, 255, 0.1);
        }
        
        /* Dark Mode - Takeaways and Boxes */
        .dark-mode .key-takeaways,
        .dark-mode .insight-box,
        .dark-mode .war-story {
            background: rgba(255, 255, 255, 0.05);
            color: #e9ecef;
        }
        
        .dark-mode .key-takeaways h3,
        .dark-mode .insight-box h3,
        .dark-mode .war-story h3 {
            color: #e9ecef;
        }
        
        .dark-mode .key-takeaways p,
        .dark-mode .insight-box p,
        .dark-mode .war-story p {
            color: #e9ecef;
        }
        
        .dark-mode .key-takeaways li,
        .dark-mode .insight-box li,
        .dark-mode .war-story li {
            color: #e9ecef;
        }
    </style>

    <style>
    .contextual-link {
        color: #667eea;
        text-decoration: none;
        font-weight: 500;
        border-bottom: 1px dotted #667eea;
        transition: all 0.2s ease;
    }
    
    .contextual-link:hover {
        color: #5a6fd8;
        border-bottom-style: solid;
    }
    
    .dark-mode .contextual-link {
        color: #9bb5ff;
        border-bottom-color: #9bb5ff;
    }
    </style>
        <style>

/* ========================================
   NARRATIVE LINKING SYSTEM STYLES
   ======================================== */

/* Contextual Links */
.contextual-link  {
    color: #3b82f6;
    text-decoration: none;
    border-bottom: 1px solid rgba(59, 130, 246, 0.3);
    transition: all 0.2s ease;
    padding-bottom: 1px;
}

.contextual-link:hover {
    color: #1d4ed8;
    border-bottom-color: #1d4ed8;
    background: rgba(59, 130, 246, 0.05);
    padding: 2px 4px;
    margin: -2px -4px;
    border-radius: 3px;
}

/* Narrative Callouts */
.narrative-callout {
    margin: 2rem 0;
    padding: 1.5rem;
    border-radius: 12px;
    border: 1px solid #e5e7eb;
    background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
}

.narrative-callout.next-step {
    border-left: 4px solid #10b981;
    background: linear-gradient(135deg, #ecfdf5 0%, #f0fdf4 100%);
}

.narrative-callout.evolution {
    border-left: 4px solid #f59e0b;
    background: linear-gradient(135deg, #fffbeb 0%, #fefce8 100%);
}

.callout-header {
    display: flex;
    align-items: center;
    margin-bottom: 0.75rem;
}

.callout-icon {
    font-size: 1.25rem;
    margin-right: 0.5rem;
}

.callout-header h4 {
    margin: 0;
    font-size: 1.1rem;
    font-weight: 600;
    color: #1f2937;
}

.narrative-link {
    color: #059669;
    text-decoration: none;
    font-weight: 500;
    border-bottom: 2px solid rgba(5, 150, 105, 0.2);
    transition: all 0.2s ease;
}

.narrative-link:hover {
    color: #047857;
    border-bottom-color: #047857;
    background: rgba(5, 150, 105, 0.1);
    padding: 2px 4px;
    margin: -2px -4px;
    border-radius: 4px;
}

.callout-meta {
    display: flex;
    gap: 1rem;
    margin-top: 1rem;
    font-size: 0.875rem;
    color: #6b7280;
}

/* Journey Progress */
.journey-progress {
    margin-top: 1rem;
}

.progress-bar {
    width: 100%;
    height: 4px;
    background: rgba(249, 115, 22, 0.2);
    border-radius: 2px;
    overflow: hidden;
}

.progress-fill {
    height: 100%;
    background: linear-gradient(90deg, #f97316 0%, #ea580c 100%);
    border-radius: 2px;
    transition: width 0.3s ease;
}

.progress-text {
    display: block;
    margin-top: 0.5rem;
    font-size: 0.8rem;
    color: #9ca3af;
}

/* Related Chapters */
.related-chapters {
    margin: 2.5rem 0;
    padding: 2rem;
    background: linear-gradient(135deg, #f9fafb 0%, #f3f4f6 100%);
    border-radius: 12px;
    border: 1px solid #e5e7eb;
}

.related-chapters h4 {
    margin: 0 0 1.5rem 0;
    font-size: 1.2rem;
    color: #1f2937;
    display: flex;
    align-items: center;
}

.related-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 1.5rem;
}

.related-item {
    display: flex;
    align-items: flex-start;
    gap: 1rem;
    padding: 1.25rem;
    background: white;
    border-radius: 8px;
    border: 1px solid #e5e7eb;
    transition: all 0.2s ease;
}

.related-item:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 16px -4px rgba(0, 0, 0, 0.1);
    border-color: #3b82f6;
}

.related-icon {
    font-size: 1.5rem;
    min-width: 2rem;
}

.related-content {
    flex: 1;
}

.related-link {
    color: #1f2937;
    text-decoration: none;
    font-weight: 600;
    transition: color 0.2s ease;
}

.related-link:hover {
    color: #3b82f6;
}

.related-desc {
    margin: 0.5rem 0;
    color: #6b7280;
    font-size: 0.9rem;
    line-height: 1.4;
}

.related-connection {
    font-size: 0.8rem;
    color: #9ca3af;
    font-style: italic;
}

/* Dark Mode Support */
.dark-mode .narrative-callout {
    background: linear-gradient(135deg, #1f2937 0%, #111827 100%);
    border-color: #374151;
    color: #f9fafb;
}

.dark-mode .related-chapters {
    background: linear-gradient(135deg, #1f2937 0%, #111827 100%);
    border-color: #374151;
}

.dark-mode .related-item {
    background: #1f2937;
    border-color: #374151;
}

.dark-mode .related-link {
    color: #f9fafb;
}

.dark-mode .related-link:hover {
    color: #60a5fa;
}

/* Responsive Design */
@media (max-width: 768px) {
    .narrative-callout {
        margin: 1.5rem 0;
        padding: 1.25rem;
    }
    
    .related-grid {
        grid-template-columns: 1fr;
        gap: 1rem;
    }
    
    .related-item {
        padding: 1rem;
    }
    
    .callout-meta {
        flex-direction: column;
        gap: 0.5rem;
    }
}
    </style>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml;base64,CiAgICA8c3ZnIHdpZHRoPSIzMiIgaGVpZ2h0PSIzMiIgdmlld0JveD0iMCAwIDMyIDMyIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgogICAgICAgIDxkZWZzPgogICAgICAgICAgICA8bGluZWFyR3JhZGllbnQgaWQ9ImdyYWQxIiB4MT0iMCUiIHkxPSIwJSIgeDI9IjEwMCUiIHkyPSIxMDAlIj4KICAgICAgICAgICAgICAgIDxzdG9wIG9mZnNldD0iMCUiIHN0eWxlPSJzdG9wLWNvbG9yOiM2NjdlZWE7c3RvcC1vcGFjaXR5OjEiIC8+CiAgICAgICAgICAgICAgICA8c3RvcCBvZmZzZXQ9IjEwMCUiIHN0eWxlPSJzdG9wLWNvbG9yOiM3NjRiYTI7c3RvcC1vcGFjaXR5OjEiIC8+CiAgICAgICAgICAgIDwvbGluZWFyR3JhZGllbnQ+CiAgICAgICAgPC9kZWZzPgogICAgICAgIDwhLS0gQmFja2dyb3VuZCBjaXJjbGUgLS0+CiAgICAgICAgPGNpcmNsZSBjeD0iMTYiIGN5PSIxNiIgcj0iMTUiIGZpbGw9InVybCgjZ3JhZDEpIiBzdHJva2U9IiNmZmYiIHN0cm9rZS13aWR0aD0iMiIvPgogICAgICAgIDwhLS0gQUkgQnJhaW4gaWNvbiAtLT4KICAgICAgICA8Y2lyY2xlIGN4PSIxNiIgY3k9IjEzIiByPSI4IiBmaWxsPSJub25lIiBzdHJva2U9IiNmZmYiIHN0cm9rZS13aWR0aD0iMiIvPgogICAgICAgIDxjaXJjbGUgY3g9IjEzIiBjeT0iMTEiIHI9IjEiIGZpbGw9IiNmZmYiLz4KICAgICAgICA8Y2lyY2xlIGN4PSIxOSIgY3k9IjExIiByPSIxIiBmaWxsPSIjZmZmIi8+CiAgICAgICAgPHBhdGggZD0iTTEyIDE1YzEgMiAzIDIgNCAyczMgMCA0LTIiIHN0cm9rZT0iI2ZmZiIgc3Ryb2tlLXdpZHRoPSIxLjUiIGZpbGw9Im5vbmUiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIvPgogICAgICAgIDwhLS0gVGVhbSBvcmNoZXN0cmF0aW9uIGxpbmVzIC0tPgogICAgICAgIDxwYXRoIGQ9Ik04IDI0TDE2IDIwTDI0IDI0IiBzdHJva2U9IiNmZmYiIHN0cm9rZS13aWR0aD0iMiIgZmlsbD0ibm9uZSIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIi8+CiAgICAgICAgPGNpcmNsZSBjeD0iOCIgY3k9IjI0IiByPSIyIiBmaWxsPSIjZmZmIi8+CiAgICAgICAgPGNpcmNsZSBjeD0iMTYiIGN5PSIyMCIgcj0iMiIgZmlsbD0iI2ZmZiIvPgogICAgICAgIDxjaXJjbGUgY3g9IjI0IiBjeT0iMjQiIHI9IjIiIGZpbGw9IiNmZmYiLz4KICAgIDwvc3ZnPgogICAg">
    <link rel="apple-touch-icon" href="data:image/svg+xml;base64,CiAgICA8c3ZnIHdpZHRoPSIzMiIgaGVpZ2h0PSIzMiIgdmlld0JveD0iMCAwIDMyIDMyIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgogICAgICAgIDxkZWZzPgogICAgICAgICAgICA8bGluZWFyR3JhZGllbnQgaWQ9ImdyYWQxIiB4MT0iMCUiIHkxPSIwJSIgeDI9IjEwMCUiIHkyPSIxMDAlIj4KICAgICAgICAgICAgICAgIDxzdG9wIG9mZnNldD0iMCUiIHN0eWxlPSJzdG9wLWNvbG9yOiM2NjdlZWE7c3RvcC1vcGFjaXR5OjEiIC8+CiAgICAgICAgICAgICAgICA8c3RvcCBvZmZzZXQ9IjEwMCUiIHN0eWxlPSJzdG9wLWNvbG9yOiM3NjRiYTI7c3RvcC1vcGFjaXR5OjEiIC8+CiAgICAgICAgICAgIDwvbGluZWFyR3JhZGllbnQ+CiAgICAgICAgPC9kZWZzPgogICAgICAgIDwhLS0gQmFja2dyb3VuZCBjaXJjbGUgLS0+CiAgICAgICAgPGNpcmNsZSBjeD0iMTYiIGN5PSIxNiIgcj0iMTUiIGZpbGw9InVybCgjZ3JhZDEpIiBzdHJva2U9IiNmZmYiIHN0cm9rZS13aWR0aD0iMiIvPgogICAgICAgIDwhLS0gQUkgQnJhaW4gaWNvbiAtLT4KICAgICAgICA8Y2lyY2xlIGN4PSIxNiIgY3k9IjEzIiByPSI4IiBmaWxsPSJub25lIiBzdHJva2U9IiNmZmYiIHN0cm9rZS13aWR0aD0iMiIvPgogICAgICAgIDxjaXJjbGUgY3g9IjEzIiBjeT0iMTEiIHI9IjEiIGZpbGw9IiNmZmYiLz4KICAgICAgICA8Y2lyY2xlIGN4PSIxOSIgY3k9IjExIiByPSIxIiBmaWxsPSIjZmZmIi8+CiAgICAgICAgPHBhdGggZD0iTTEyIDE1YzEgMiAzIDIgNCAyczMgMCA0LTIiIHN0cm9rZT0iI2ZmZiIgc3Ryb2tlLXdpZHRoPSIxLjUiIGZpbGw9Im5vbmUiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIvPgogICAgICAgIDwhLS0gVGVhbSBvcmNoZXN0cmF0aW9uIGxpbmVzIC0tPgogICAgICAgIDxwYXRoIGQ9Ik04IDI0TDE2IDIwTDI0IDI0IiBzdHJva2U9IiNmZmYiIHN0cm9rZS13aWR0aD0iMiIgZmlsbD0ibm9uZSIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIi8+CiAgICAgICAgPGNpcmNsZSBjeD0iOCIgY3k9IjI0IiByPSIyIiBmaWxsPSIjZmZmIi8+CiAgICAgICAgPGNpcmNsZSBjeD0iMTYiIGN5PSIyMCIgcj0iMiIgZmlsbD0iI2ZmZiIvPgogICAgICAgIDxjaXJjbGUgY3g9IjI0IiBjeT0iMjQiIHI9IjIiIGZpbGw9IiNmZmYiLz4KICAgIDwvc3ZnPgogICAg">
</head>
<body>
    <div class="container">
        <nav class="breadcrumb">
            <a href="../../ai-team-orchestrator.html">üè† AI Team Orchestrator</a>
            <span>‚Ä∫</span>
            <a href="../">üéª Core Philosophy and Architecture</a>
            <span>‚Ä∫</span>
            <span>Isolating Intelligence - LLM Mock</span>
        </nav>

        <header class="chapter-header">
            <div class="chapter-instrument">üß™</div>
            <div class="chapter-meta">
                <span>üéª Movement 1 of 4</span>
                <span>üìñ Chapter 3 of 42</span>
                <span>‚è±Ô∏è ~18 min read</span>
                <span>üìä Level: Advanced</span>
            </div>
            <h1 class="chapter-title">Isolating Intelligence - The LLM Mock Strategy</h1>
            <p class="chapter-summary">
                How to effectively test non-deterministic AI systems. 
                Mocking strategies that actually work in production.
            </p>

                <div class="narrative-callout next-step">
                    <div class="callout-header">
                        <span class="callout-icon">üéØ</span>
                        <h4>Next Step in Your Journey</h4>
                    </div>
                    <p>Now that you understand specialist agent architecture, it's time to build the <a href="../agent-toolbox/" class="narrative-link">perfect toolkit</a> to orchestrate them effectively.</p>
                    <div class="callout-meta">
                        <span class="reading-time">‚è±Ô∏è 8 min read</span>
                        <span class="difficulty">üìä Intermediate</span>
                    </div>
                </div>
                

        </header>

        <!-- Chapter Content -->
        <article class="chapter-content">
            <p>We had a well-defined <code>SpecialistAgent</code>, clean architecture, and robust data contracts. We were ready to build the rest of the system. But we immediately ran into a problem as trivial as it was blocking: <strong>how do you test a system whose heart is a call to an external service thats unpredictable and expensive like an LLM?</strong></p>
            
            <p>Every execution of our integration tests would involve:</p>
            <ol>
                <li><strong>Monetary Costs:</strong> Real calls to OpenAI APIs.</li>
                <li><strong>Slowness:</strong> Waiting seconds, sometimes minutes, for a response.</li>
                <li><strong>Non-Determinism:</strong> The same input could produce slightly different outputs, making tests unreliable.</li>
            </ol>
            
            <div class="mermaid-container">
                <h4>AI Provider Abstraction Layer</h4>
                <div class="mermaid">
graph TD
    A[Agent Executor] -->
    B{AI Provider Abstraction}
    B -->
    C{Is Mocking Enabled?}
    C -- Yes -->
    D[Return Mock Response]
    C -- No -->
    E[Forward Call to OpenAI SDK]
    D -->
    F[Immediate and Controlled Response]
    E -->
    F
    F -->
    A
    
    subgraph "Test Logic"
        C
        D
    end
    
    subgraph "Production Logic"
        E
    end
</div>
            </div>
            
            <div class="war-story">
                <div class="war-story-header">
                    <h4>"War Story": The Commit That Saved the Budget (and the Project)</h4>
                </div>
                <p><em>Evidence from Git Log: <code>f7627da (Fix stubs and imports for tests)</code></em></p>
                    
                    <p>This seemingly innocent change was one of the most important of the initial phase. Before this commit, our first integration tests, running in a CI environment, made <strong>real calls to OpenAI APIs</strong>.</p>
                    
                    <p>On the first day, we consumed over $44 USD of our self-funded daily budget of $110 USD, simply because every push to a branch triggered a series of tests that called <code>gpt-4</code> dozens of times.</p>
                    
                    <h5>The Financial Context: AI in a Self-Funded Learning Project</h5>
                    
                    <p>This wasnt just a technical concern. As a self-funded personal learning project, we had established a maximum budget of <strong>$110 USD per day</strong> for APIs. As Tunguz's analysis highlights, AI is rapidly becoming one of the main R&D expense items, potentially reaching 10-15% of the total budget easily.</p>
                    
                    <p><strong>The lesson was brutal but fundamental:</strong> <em>An AI system that cannot be tested economically and reliably is a system that cannot be developed sustainably.</em></p>
                    
                    <h5>Discovering OpenAI Tiers: Strategic Budget Planning</h5>
                    
                    <p>During the budget management challenge, we learned to intimately know the <strong>OpenAI usage tier system</strong>:</p>
                    
                    <ul>
                        <li><strong>Tier 1 (after $5 spent):</strong> $100/month limit - perfect for prototyping</li>
                        <li><strong>Tier 2 ($50 spent + 7 days):</strong> $500/month - serious development</li>
                        <li><strong>Tier 3 ($100 spent + 7 days):</strong> $1,000/month - development team</li>
                        <li><strong>Tier 4 ($250 spent + 14 days):</strong> $5,000/month - SME production</li>
                        <li><strong>Tier 5 ($1,000 spent + 30 days):</strong> $200,000/month - enterprise scale</li>
                    </ul>
                    
                    <p>Our strategy: <strong>95% mock tests for rapid and economical development, 5% real tests for final validation</strong>.</p>
                    
                    <h5>The CLI Coding Effect: When Tests Multiply</h5>
                    
                    <p>Ironically, just as we managed to contain API costs with mocks, a new challenge emerged: the advent of <strong>AI-assisted coding CLIs</strong>. Tools like Claude Code, GitHub Copilot CLI, and Cursor revolutionized how we write code.</p>
                    
                    <p>Where we used to manually write 10 tests per component, now with AI assistance we easily generate 100+ in minutes. The paradox: while the <em>cost per test</em> drops, the <em>total volume of tests</em> grows exponentially.</p>
                    ;
                    <p>Implementing the AI Abstraction Layer wasnt just a best practice; it was an <strong>economic survival decision</strong>:</p>
                    
                    <ul>
                        <li><strong>Free:</strong> 99% of tests now run without API costs</li>
                        <li><strong>Fast:</strong> From 10 minutes to 30 seconds for complete suite</li>
                        <li><strong>Reliable:</strong> Deterministic and repeatable tests</li>
                    </ul>

            </div>
            
            <div class="key-takeaways">
                <h4>End of the Third Movement</h4>
                <p>Isolating intelligence was the step that allowed us to transition from "experimenting with AI" to "doing software engineering with AI". It gave us the confidence and tools to build the rest of the architecture on solid and testable foundations.</p>
                <p>With a robust single agent and reliable testing environment, we were finally ready to tackle the next challenge: making multiple agents collaborate. This led us to create the <strong>Orchestra Director</strong>, the beating heart of our AI team.</p>
            </div>
        </article>

        <nav class="chapter-nav-bottom">
            <a href="../first-specialist-agent-architecture/" class="nav-button secondary">
                ‚Üê Chapter 2: First Agent
            </a>
            <a href="../drama-parsing-ai-contracts/" class="nav-button">
                Chapter 4: Parsing AI ‚Üí
            </a>
        </nav>
    </div>
</div>

    <!-- Mermaid.js for diagrams -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
    <script>
        mermaid.initialize({ 
            startOnLoad: true,
            theme: 'base',
            themeVariables: {
                primaryColor: #667eea,
                primaryTextColor: '#2c3e50',',
                primaryBorderColor: #667eea,
                lineColor: '#7f8c8d',
                secondaryColor: #f8f9fa,
                tertiaryColor: #ffffff
            }
        });
    </script>

    <!-- Prism.js for code highlighting -->
    <link href="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/themes/prism-tomorrow.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>

    <script async src="https://www.googletagmanager.com/gtag/js?id=G-VEGK4VZMG0"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', G-VEGK4VZMG0');
        
        gtag('event', 'chapter_start', {
            chapter_title: 'Isolating Intelligence - The LLM Mock Strategy',
            'movement: 'core-philosophy-architecture',
            chapter_number: 3
        });
    </script>

        <!-- Reader Tools -->
        <div class="reader-tools" id="readerTools">
            <button class="reader-tools-toggle" onclick="toggleReaderTools()">‚öô</button>
            
            <div class="reader-tool" onclick="toggleTheme()">
                <span class="reader-tool-icon" id="themeIcon">üåô</span>
                <span class="reader-tool-label">Theme</span>
            </div>
            
            <div class="reader-tool" onclick="toggleBookmark()">
                <span class="reader-tool-icon">üîñ</span>
                <span class="reader-tool-label">Bookmark</span>
            </div>
            
            <div class="reader-tool" onclick="showBookmarks()">
                <span class="reader-tool-icon">üìö</span>
                <span class="reader-tool-label">My Bookmarks</span>
            </div>
            
            <div class="language-switcher">
                <select class="language-select" onchange="switchLanguage(this.value)">
                    <option value="en">üá¨üáß EN</option>
                    <option value="it">üáÆüáπ IT</option>
                </select>
            </div>
            
            <div class="reader-tool" onclick="showFontSizeMenu()">
                <span class="reader-tool-icon">üî§</span>
                <span class="reader-tool-label">Font Size</span>
            </div>
        </div>
        
        <!-- Reading Progress -->
        <div class="reading-progress">
            <div class="reading-progress-fill" id="progressFill"></div>
        </div>
        
        <!-- Bookmark Toast -->
        <div class="bookmark-toast" id="bookmarkToast">
            <span id="bookmarkMessage">Bookmark saved!</span>
        </div>        </div>
        
        <!-- Bookmarks Modal -->
        <div class="bookmarks-modal" id="bookmarksModal" onclick="closeBookmarksModal(event)">
            <div class="bookmarks-content" onclick="event.stopPropagation()">
                <div class="bookmarks-header">
                    <h2 class="bookmarks-title">üìö My Bookmarks</h2>
                    <button class="bookmarks-close" onclick="closeBookmarksModal()">‚úï</button>
                </div>
                <div class="bookmarks-list" id="bookmarksList">
                    <!-- Bookmarks will be populated by JavaScript -->
                </div>
</div>

    
    <script>
        // Complete Reader Tools JavaScript Functions
        
        function toggleTheme() {
            const body = document.body;
            const themeIcon = document.getElementById('themeIcon')
            const isDarkMode = body.classList.contains('dark-mode');
            
            if (isDarkMode) {
                body.classList.remove('dark-mode');
                if (themeIcon) themeIcon.textContent = 'üåô';
                localStorage.setItem('theme', 'light');
            } else {
                body.classList.add('dark-mode);
                if (themeIcon) themeIcon.textContent = '‚òÄÔ∏è';
                localStorage.setItem(theme', dark);
            }
        }
        
        function toggleBookmark() {
            const currentPage = window.location.pathname;
            const pageTitle = document.querySelector('.chapter-title')?.textContent || 'Chapter';
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarks') || '[]'');
            const existingIndex = bookmarks.findIndex(b => b.url === currentPage);
            
            if (existingIndex > -1) {
                bookmarks.splice(existingIndex, 1);
                showToast('Bookmark removed!', 'error');
            } else {
                bookmarks.push({
                    url: currentPage,
                    title: pageTitle,
                    timestamp: new Date().toISOString()
                });
                showToast('Bookmark saved!', 'success');
            }
            
            localStorage.setItem('bookmarks', JSON.stringify(bookmarks));
            updateBookmarkButton();
        }
        
        function showBookmarks() {
            createBookmarksModal();
            const modal = document.getElementById('bookmarksModal')
            const bookmarksList = document.getElementById('bookmarksList')
            const bookmarks = JSON.parse(localStorage.getItem('bookmarks') || '[]);
            
            if (bookmarks.length === 0) {
                bookmarksList.innerHTML = `
                    <div class="no-bookmarks">
                        <div class="no-bookmarks-icon">üìö</div>
                        <h3>No bookmarks saved</h3>
                        <p>Start saving your favorite chapters by clicking the üîñ icon</p>
                    </div>`;
                `;
            } else {
                bookmarksList.innerHTML = bookmarks
                    .sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp))
                    .map(bookmark => `
                        <div class="bookmark-item">
                            <div class="bookmark-info">
                                <div class="bookmark-title">${bookmark.title}</div>
                                <a href="${bookmark.url}" class="bookmark-url">${bookmark.url}</a>
                                <div class="bookmark-date">Saved ${new Date(bookmark.timestamp).toLocaleDateString()}</div>
                            </div>
                            <div class="bookmark-actions">
                                <button class="bookmark-action delete" onclick="deleteBookmark(${bookmark.url})">üóëÔ∏è</button>
                            </div>
                        </div>
                    `).join();
            }
            
            modal.style.display = flex;
            document.body.style.overflow = hidden';
        }
        
        function closeBookmarksModal(event) {
            const modal = document.getElementById('bookmarksModal')
            if (modal && (!event || event.target === modal))  {
                modal.style.display = 'none'';
                document.body.style.overflow = '';
            }
        }
        
        function deleteBookmark(url) {
            let bookmarks = JSON.parse(localStorage.getItem('bookmarks') || []);
            bookmarks = bookmarks.filter(b => b.url !== url);
            localStorage.setItem('bookmarks', JSON.stringify(bookmarks));
            showToast('Bookmark removed!', 'error');
            showBookmarks();
        }
        
        function showFontSizeMenu() {
            const currentSize = localStorage.getItem('fontSize'') || 'medium';
            const sizes = [small, medium', large];
            const currentIndex = sizes.indexOf(currentSize);
            const newSize = sizes[(currentIndex + 1) % sizes.length];
            
            setFontSize(newSize);
            localStorage.setItem('fontSize', ', newSize);
            showToast(`Font size: ${newSize}`, 'success');
        }
        
        function setFontSize(size) {
            const root = document.documentElement;
            const sizes = {
                'small': 0.9,
                'medium': 1.0,
                'large': 1.1
            };
            if (sizes[size]) {
                root.style.fontSize = sizes[size] + em;
            }
        }
        
        function showToast(message, type = 'success') {
            let toast = document.getElementById('bookmarkToast')
            
            if (!toast) {
                toast = document.createElement('div);
                toast.id = bookmarkToast;
                toast.className = bookmark-toast;
                toast.innerHTML = <span id="bookmarkMessage"></span>;
        </div>                toast.style.cssText = `
                    position: fixed;
                    top: 80px;
                    right: 20px;
                    padding: 12px 20px;
                    border-radius: 8px;
                    color: white;
                    font-weight: 500;
                    z-index: 10001;
                    transform: translateX(100%);
                    transition: transform 0.3s ease;
                    background: #28a745;
                `;
                document.body.appendChild(toast);
            }
            
            const messageEl = document.getElementById('bookmarkMessage')
            if (messageEl) messageEl.textContent = message;
            
            toast.style.background = type === 'error' ? '#dc3545 : #28a745;
            toast.style.transform = 'translateX(0)';
            
            setTimeout(() => {
                toast.style.transform = translateX(100%);
            }, 3000);
        }
        
        function toggleReaderTools() {
            const tools = document.getElementById('readerTools')
            if (tools) {
                tools.classList.toggle('collapsed');
                localStorage.setItem('readerToolsCollapsed', tools.classList.contains('collapsed'));
            }
        }
        
        function updateBookmarkButton() {
            const currentPage = window.location.pathname;
            const bookmarks = JSON.parse(localStorage.getItem('bookmarks') || []);
            const isBookmarked = bookmarks.some(b => b.url === currentPage);
            
            const bookmarkTool = document.querySelector('.reader-tool[onclick*="toggleBookmark"]');
            if (bookmarkTool) {
                bookmarkTool.classList.toggle('active', isBookmarked);
            }
        }
        
        function switchLanguage(lang) {
            const currentPath = window.location.pathname;
            let newPath = currentPath;
            
            if (lang === 'en' && currentPath.includes(/it/))  {
                newPath = currentPath.replace(/it/', /en/);
                    .replace(filosofia-core-architettura, core-philosophy-architecture')
                    .replace(user-experience-trasparenza, user-experience-transparency)
                    .replace(esecuzione-qualita, execution-quality);
            } else if (lang === 'it && currentPath.includes(/en/'))  {
                newPath = currentPath.replace(/en/, /it/);
                    .replace(core-philosophy-architecture, filosofia-core-architettura)
                    .replace('user-experience-transparency, user-experience-trasparenza)
                    .replace(execution-quality, 'esecuzione-qualita);
            }
            
            if (newPath !== currentPath) {
                window.location.href = newPath;
            }
        }
        
        function updateReadingProgress() {
            const progressFill = document.getElementById('progressFill')
            if (!progressFill) return;
            
            window.addEventListener('scroll', () => {
                const article = document.querySelector('.chapter-content');
                if (!article) return;
                
                const articleTop = article.offsetTop;
                const articleHeight = article.offsetHeight;
                const windowHeight = window.innerHeight;
                const scrollTop = window.pageYOffset;
                
                const progress = Math.min(100, Math.max(0, 
                    ((scrollTop + windowHeight - articleTop) / articleHeight) * 100;
                ));
                
                progressFill.style.width = progress + '%';
            });
        }
        
        function loadUserPreferences() {
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'dark') {
                document.body.classList.add('dark-mode');
                const themeIcon = document.getElementById('themeIcon')
                if (themeIcon) themeIcon.textContent = '‚òÄÔ∏è';
            }
            
            const savedFontSize = localStorage.getItem('fontSize'');
            if (savedFontSize) {
                setFontSize(savedFontSize);
            }
            
            const toolsCollapsed = localStorage.getItem('readerToolsCollapsed') === true;
            if (toolsCollapsed) {
                const tools = document.getElementById('readerTools')
                if (tools) tools.classList.add('collapsed');
            }
        }
        
        function initializeReaderTools() {
            updateBookmarkButton();
            updateReadingProgress();
            loadUserPreferences();
        }
        
        function stopPropagation(event) {
            if (event) {
                event.stopPropagation();
            }
        }
        
        function createBookmarksModal() {
            if (document.getElementById('bookmarksModal')) return;
            
            const modal = document.createElement(div);
            modal.id = bookmarksModal;
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0,0,0,0.8);
                z-index: 10000;
                display: none;
                align-items: center;
                justify-content: center;
                padding: 2rem;
            `;
            
            modal.innerHTML = `;
                <div style="background: white; border-radius: 15px; padding: 2rem; max-width: 500px; width: 100%; max-height: 80vh; overflow-y: auto;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; padding-bottom: 1rem; border-bottom: 2px solid #f1f3f4;">
                        <h2 style="margin: 0; color: #2c3e50;">üìö My Bookmarks</h2>
                        <button onclick="closeBookmarksModal()" style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: #adb5bd;">‚úï</button>
                    </div>
                    <div id="bookmarksList"></div>
                </div>`;
            `;
            
            modal.onclick = closeBookmarksModal;
            document.body.appendChild(modal);
        }
        
        // Initialize on DOM load
        document.addEventListener(DOMContentLoaded', initializeReaderTools);
    </script>

<!-- universal-progress-bar-added -->
</body>
</html>
