<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Architectural Fork - Direct API vs SDK | Core Philosophy Architecture | AI Team Orchestrator</title>
    <meta name="description" content="Chapter 5 of AI Team Orchestrator: The Architectural Fork - Direct API vs SDK">
    <meta name="robots" content="index, follow">
    
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: #2c3e50;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            padding: 2rem;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            padding: 3rem;
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
        }
        
        .chapter-header {
            text-align: center;
            margin-bottom: 3rem;
        }
        
        .chapter-instrument {
            font-size: 4rem;
            margin-bottom: 1rem;
        }
        
        .chapter-meta {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin-bottom: 1rem;
            font-size: 0.9rem;
            color: #7f8c8d;
            flex-wrap: wrap;
        }
        
        .chapter-title {
            font-size: 2.5rem;
            color: #2c3e50;
            margin-bottom: 2rem;
            font-weight: 700;
            line-height: 1.2;
        }
        
        .breadcrumb {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 2rem;
            font-size: 0.9rem;
            color: #7f8c8d;
            background: rgba(102, 126, 234, 0.1);
            padding: 1rem 1.5rem;
            border-radius: 50px;
        }
        
        .breadcrumb a {
            color: #667eea;
            text-decoration: none;
        }
        
        .breadcrumb a:hover {
            text-decoration: underline;
        }
        
        .nav-button {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 1rem 2rem;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            text-decoration: none;
            border-radius: 50px;
            font-weight: 600;
            transition: all 0.3s ease;
            margin: 1rem 0.5rem;
        }
        
        .nav-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 40px rgba(102, 126, 234, 0.6);
        }
        
        /* Reader Tools */
        .reader-tools {
            position: fixed;
            top: 50%;
            right: 20px;
            transform: translateY(-50%);
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 1rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 0.8rem;
            transition: all 0.3s ease;
            min-width: 60px;
        }
        
        .reader-tools.collapsed {
            width: 60px;
            padding: 0.8rem;
        }
        
        .reader-tool {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.6rem;
            border: none;
            background: transparent;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.2s ease;
            color: #495057;
            font-size: 0.85rem;
            white-space: nowrap;
        }
        
        .reader-tool:hover {
            background: rgba(102, 126, 234, 0.1);
            color: #667eea;
        }
        
        .reader-tool.active {
            background: #667eea;
            color: white;
        }
        
        .reader-tool-icon {
            font-size: 1.1rem;
            flex-shrink: 0;
        }
        
        .reader-tool-label {
            font-size: 0.8rem;
            font-weight: 500;
        }
        
        .collapsed .reader-tool-label {
            display: none;
        }
        
        .reader-tools-toggle {
            position: absolute;
            top: -10px;
            left: -10px;
            width: 30px;
            height: 30px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }
        
        /* Language Switcher */
        .language-switcher {
            display: flex;
            background: rgba(0,0,0,0.1);
            border-radius: 6px;
            overflow: hidden;
        }
        
        .language-select {
            background: transparent;
            border: none;
            color: inherit;
            font-size: 0.75rem;
            font-weight: 600;
            cursor: pointer;
            outline: none;
            min-width: 60px;
        }
        
        .language-select option {
            background: white;
            color: #2c3e50;
        }
        
        /* Reading Progress */
        .reading-progress {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background: rgba(102, 126, 234, 0.2);
            z-index: 1001;
        }
        
        .reading-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            width: 0%;
            transition: width 0.3s ease;
        }
        
        /* Tables */
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 1.5rem 0;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        th, td {
            padding: 12px 16px;
            text-align: left;
            border-bottom: 1px solid #e9ecef;
        }
        
        th {
            background: #f8f9fa;
            font-weight: 600;
            color: #495057;
        }
        
        tbody tr:hover {
            background: #f8f9fa;
        }
        
        tbody tr:last-child td {
            border-bottom: none;
        }
        
        /* Dark Mode */
        body.dark-mode {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #e9ecef;
        }
        
        .dark-mode .container {
            background: rgba(255, 255, 255, 0.05);
            color: #e9ecef;
        }
        
        .dark-mode .chapter-title {
            color: #e9ecef !important;
        }
        
        .dark-mode .breadcrumb {
            background: rgba(255, 255, 255, 0.1);
            color: #e9ecef;
        }
        
        .dark-mode .reader-tools {
            background: rgba(0, 0, 0, 0.8);
            color: #e9ecef;
        }
        
        .dark-mode .reader-tool {
            color: #e9ecef;
        }
        
        .dark-mode .reader-tool:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .dark-mode table {
            background: rgba(255, 255, 255, 0.05);
        }
        
        .dark-mode th,
        .dark-mode td {
            color: #e9ecef;
            border-bottom-color: rgba(255, 255, 255, 0.1);
        }
        
        .dark-mode th {
            background: rgba(255, 255, 255, 0.1);
        }
        
        /* Mermaid Container */
        .mermaid {
            background: #f8f9fa;
            padding: 2rem;
            border-radius: 10px;
            margin: 2rem 0;
            text-align: center;
        }
        
        .mermaid svg {
            max-width: 100%;
            height: auto;
        }
        
        /* Key Takeaways Styling */
        .key-takeaways-section {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: white;
            border-radius: 10px;
            padding: 2rem;
            margin: 2rem 0;
        }
        
        .key-takeaways-title {
            margin-bottom: 1rem;
            font-weight: 600;
        }
        
        .takeaway-item {
            margin-bottom: 0.5rem;
        }
        
        /* Fixed Bookmark Toast */
        .bookmark-toast {
            position: fixed;
            top: 80px;
            right: 20px;
            background: #28a745;
            color: white;
            padding: 0.8rem 1.2rem;
            border-radius: 8px;
            z-index: 1002;
            transform: translateX(350px);
            opacity: 0;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            box-shadow: 0 5px 15px rgba(40, 167, 69, 0.3);
            pointer-events: none;
        }
        
        .bookmark-toast.show {
            transform: translateX(0);
            opacity: 1;
            pointer-events: auto;
        }
        
        .bookmark-toast.error {
            background: #dc3545;
            box-shadow: 0 5px 15px rgba(220, 53, 69, 0.3);
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            body {
                padding: 1rem;
            }
            
            .container {
                padding: 2rem;
            }
            
            .reader-tools {
                right: 10px;
                padding: 0.8rem;
                min-width: 50px;
            }
            
            .reader-tools.collapsed {
                width: 50px;
                padding: 0.6rem;
            }
        }
    </style>
    
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml;base64,CiAgICA8c3ZnIHdpZHRoPSIzMiIgaGVpZ2h0PSIzMiIgdmlld0JveD0iMCAwIDMyIDMyIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgogICAgICAgIDxkZWZzPgogICAgICAgICAgICA8bGluZWFyR3JhZGllbnQgaWQ9ImdyYWQxIiB4MT0iMCUiIHkxPSIwJSIgeDI9IjEwMCUiIHkyPSIxMDAlIj4KICAgICAgICAgICAgICAgIDxzdG9wIG9mZnNldD0iMCUiIHN0eWxlPSJzdG9wLWNvbG9yOiM2NjdlZWE7c3RvcC1vcGFjaXR5OjEiIC8+CiAgICAgICAgICAgICAgICA8c3RvcCBvZmZzZXQ9IjEwMCUiIHN0eWxlPSJzdG9wLWNvbG9yOiM3NjRiYTI7c3RvcC1vcGFjaXR5OjEiIC8+CiAgICAgICAgICAgIDwvbGluZWFyR3JhZGllbnQ+CiAgICAgICAgPC9kZWZzPgogICAgICAgIDxjaXJjbGUgY3g9IjE2IiBjeT0iMTYiIHI9IjE1IiBmaWxsPSJ1cmwoI2dyYWQxKSIgc3Ryb2tlPSIjZmZmIiBzdHJva2Utd2lkdGg9IjIiLz4KICAgICAgICA8Y2lyY2xlIGN4PSIxNiIgY3k9IjEzIiByPSI4IiBmaWxsPSJub25lIiBzdHJva2U9IiNmZmYiIHN0cm9rZS13aWR0aD0iMiIvPgogICAgICAgIDxjaXJjbGUgY3g9IjEzIiBjeT0iMTEiIHI9IjEiIGZpbGw9IiNmZmYiLz4KICAgICAgICA8Y2lyY2xlIGN4PSIxOSIgY3k9IjExIiByPSIxIiBmaWxsPSIjZmZmIi8+CiAgICAgICAgPHBhdGggZD0iTTEyIDE1YzEgMiAzIDIgNCAyczMgMCA0LTIiIHN0cm9rZT0iI2ZmZiIgc3Ryb2tlLXdpZHRoPSIxLjUiIGZpbGw9Im5vbmUiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIvPgogICAgICAgIDxwYXRoIGQ9Ik04IDI0TDE2IDIwTDI0IDI0IiBzdHJva2U9IiNmZmYiIHN0cm9rZS13aWR0aD0iMiIgZmlsbD0ibm9uZSIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIi8+CiAgICAgICAgPGNpcmNsZSBjeD0iOCIgY3k9IjI0IiByPSIyIiBmaWxsPSIjZmZmIi8+CiAgICAgICAgPGNpcmNsZSBjeD0iMTYiIGN5PSIyMCIgcj0iMiIgZmlsbD0iI2ZmZiIvPgogICAgICAgIDxjaXJjbGUgY3g9IjI0IiBjeT0iMjQiIHI9IjIiIGZpbGw9IiNmZmYiLz4KICAgIDwvc3ZnPgo=">
    <link rel="canonical" href="https://books.danielepelleri.com/en/core-philosophy-architecture/sdk-vs-direct-api-battle/" />
</head>
<body>
    <div class="container">
        <!-- Breadcrumb -->
        <nav class="breadcrumb">
            <a href="../../ai-team-orchestrator.html">üè† AI Team Orchestrator</a>
            <span>‚Ä∫</span>
            <a href="../">üéª Core Philosophy & Architecture</a>
            <span>‚Ä∫</span>
            <span>The Architectural Fork - Direct API vs SDK</span>
        </nav>
        
        <header class="chapter-header">
            <div class="chapter-instrument">üéª</div>
            <div class="chapter-meta">
                <span>Movement 1 of 4</span>
                <span>Chapter 5 of 42</span>
                <span>Ready to Read</span>
            </div>
            <h1 class="chapter-title">The Architectural Fork ‚Äì Direct Call vs. SDK</h1>
        </header>

        <div class="chapter-content">
            <p>With a reliable single agent and a robust parsing system, we had overcome the "micro" challenges. Now we had to face the first, major "macro" decision that would define the entire architecture of our system: <strong>how should our agents communicate with each other and with the outside world?</strong></p>

            <p>We found ourselves facing a fundamental fork in the road:</p>

            <ol>
                <li><strong>The Fast Track (Direct Call):</strong> Continue using direct calls to OpenAI APIs (or any other provider) through libraries like <code>requests</code> or <code>httpx</code>.</li>
                <li><strong>The Strategic Path (SDK Abstraction):</strong> Adopt and integrate a Software Development Kit (SDK) specific for agents, like the <strong>OpenAI Agents SDK</strong>, to handle all interactions.</li>
            </ol>

            <p>The first option was tempting. It was fast, simple, and would have allowed us to have immediate results. But it was a trap. A trap that would have transformed our code into a fragile and hard-to-maintain monolith.</p>

            <h3>Fork Analysis: Hidden Costs vs. Long-Term Benefits</h3>

            <p>We analyzed the decision not only from a technical standpoint, but especially from a strategic one, evaluating the long-term impact of each choice on our pillars.</p>

            <table>
                <thead>
                    <tr>
                        <th>Evaluation Criteria</th>
                        <th>Direct Call Approach (‚ùå)</th>
                        <th>SDK-Based Approach (‚úÖ)</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>Coupling</strong></td>
                        <td><strong>High.</strong> Each agent would be tightly coupled to the specific implementation of OpenAI APIs. Changing providers would require massive rewriting.</td>
                        <td><strong>Low.</strong> The SDK abstracts implementation details. We could (in theory) change the underlying AI provider by modifying only the SDK configuration.</td>
                    </tr>
                    <tr>
                        <td><strong>Maintainability</strong></td>
                        <td><strong>Low.</strong> Error handling, retry, logging, and context management logic would be duplicated at every point in the code where a call was made.</td>
                        <td><strong>High.</strong> All complex AI interaction logic is centralized in the SDK. We focus on business logic, the SDK handles communication.</td>
                    </tr>
                    <tr>
                        <td><strong>Scalability</strong></td>
                        <td><strong>Low.</strong> Adding new capabilities (like conversational memory management or complex tool usage) would require reinventing the wheel every time.</td>
                        <td><strong>High.</strong> Modern SDKs are designed to be extensible. They already provide primitives for memory, planning, and tool orchestration.</td>
                    </tr>
                    <tr>
                        <td><strong>Pillar Adherence</strong></td>
                        <td><strong>Serious Violation.</strong> Would violate pillars #1 (Native SDK Usage), #4 (Reusable Components), and #14 (Modular Service-Layer).</td>
                        <td><strong>Full Alignment.</strong> Perfectly embodies our philosophy of building on solid and abstract foundations.</td>
                    </tr>
                </tbody>
            </table>

            <p>The decision was unanimous and immediate. Even though it would require a greater initial time investment, adopting an SDK was the only choice consistent with our vision of building a robust, long-term system.</p>

            <h3>SDK Primitives: Our New Superpowers</h3>

            <p>Adopting the OpenAI Agents SDK didn't just mean adding a new library; it meant changing our way of thinking. Instead of reasoning in terms of "HTTP calls", we started reasoning in terms of "agent capabilities". The SDK provided us with a set of extremely powerful primitives that became the building blocks of our architecture.</p>

            <table>
                <thead>
                    <tr>
                        <th>SDK Primitive</th>
                        <th>What It Does (in simple terms)</th>
                        <th>Problem It Solves for Us</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>Agents</strong></td>
                        <td>It's an LLM "with superpowers": has clear instructions and a set of tools it can use.</td>
                        <td>Allows us to create our <strong>SpecialistAgent</strong> cleanly, defining their role and capabilities without hard-coded logic.</td>
                    </tr>
                    <tr>
                        <td><strong>Sessions</strong></td>
                        <td>Automatically manages conversation history, ensuring an agent "remembers" previous messages.</td>
                        <td>Solves the <strong>digital amnesia</strong> problem. Essential for our contextual chat and multi-step tasks.</td>
                    </tr>
                    <tr>
                        <td><strong>Tools</strong></td>
                        <td>Transforms any Python function into a tool that the agent can decide to use autonomously.</td>
                        <td>Allows us to create a <strong>modular Tool Registry (Pillar #14)</strong> and anchor AI to real and verifiable actions (e.g., <code>websearch</code>).</td>
                    </tr>
                    <tr>
                        <td><strong>Handoffs</strong></td>
                        <td>Allows an agent to delegate a task to another more specialized agent.</td>
                        <td>This is the mechanism that enables true <strong>collaboration between agents</strong>. The Project Manager can "handoff" a technical task to the Lead Developer.</td>
                    </tr>
                    <tr>
                        <td><strong>Guardrails</strong></td>
                        <td>Security controls that validate agent inputs and outputs, blocking unsafe or low-quality operations.</td>
                        <td>This is the technical foundation on which we built our <strong>Quality Gates (Pillar #8)</strong>, ensuring only high-quality output proceeds through the flow.</td>
                    </tr>
                </tbody>
            </table>

            <p>Adopting these primitives accelerated our development exponentially. Instead of building complex systems for memory or tool management from scratch, we could leverage components that were already ready, tested, and optimized.</p>

            <h3>Beyond the SDK: The Vision of Model Context Protocol (MCP)</h3>

            <p>Our decision to adopt an SDK wasn't just a tactical choice to simplify code, but a strategic bet on a more open and interoperable future. At the heart of this vision lies a fundamental concept: the <strong>Model Context Protocol (MCP)</strong>.</p>

            <p><strong>What is MCP? The "USB-C" for Artificial Intelligence.</strong></p>

            <p>Imagine a world where every AI tool (an analysis tool, a vector database, another agent) speaks a different language. To make them collaborate, you have to build a custom adapter for every pair. It's an integration nightmare.</p>

            <p>MCP proposes to solve this problem. It's an open protocol that standardizes how applications provide context and tools to LLMs. It works like a USB-C port: a single standard that allows any AI model to connect to any data source or tool that "speaks" the same language.</p>

            <div class="mermaid">
                graph TD
                    subgraph "BEFORE: Chaos of Custom Adapters"
                        A1[AI Model A] --> B1[Adapter for Tool 1]
                        A1 --> B2[Adapter for Tool 2]
                        A2[AI Model B] --> B3[Adapter for Tool 1]
                        B1 --> C1[Tool 1]
                        B2 --> C2[Tool 2]
                        B3 --> C1
                    end

                    subgraph "AFTER: Elegance of MCP Standard"
                        D1[AI Model A] --> E{MCP Port}
                        D2[AI Model B] --> E
                        E --> F1[MCP-Compatible Tool 1]
                        E --> F2[MCP-Compatible Tool 2]  
                        E --> F3[MCP-Compatible Agent C]
                    end
            </div>

            <p><strong>Why MCP is the Future (and why we care):</strong></p>

            <p>Choosing an SDK that embraces (or moves toward) MCP principles is a strategic move that aligns perfectly with our pillars:</p>

            <table>
                <thead>
                    <tr>
                        <th>MCP Strategic Benefit</th>
                        <th>Corresponding Reference Pillar</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>End of Vendor Lock-in</strong>: If more models and tools support MCP, we can change AI providers or integrate a new third-party tool with minimal effort.</td>
                        <td>#15 (Robustness & Fallback)</td>
                    </tr>
                    <tr>
                        <td><strong>An Ecosystem of "Plug-and-Play" Tools</strong>: A true marketplace of specialized tools (financial, scientific, creative) will emerge that we can "plug" into our agents instantly.</td>
                        <td>#14 (Modular Tool/Service-Layer)</td>
                    </tr>
                    <tr>
                        <td><strong>Interoperability Between Agents</strong>: Two different agent systems, built by different companies, could collaborate if both support MCP. This unlocks automation potential at an industry-wide level.</td>
                        <td>#4 (Scalable & Self-Learning)</td>
                    </tr>
                </tbody>
            </table>

            <p>Our choice to use the OpenAI Agents SDK was therefore a bet that, even if the SDK itself is specific, the principles it's based on (tool abstraction, handoffs, context management) are the same ones guiding the MCP standard. We're building our cathedral not on sandy foundations, but on rocky terrain that is becoming standardized.</p>

            <h3>The Lesson Learned: Don't Confuse "Simple" with "Easy"</h3>

            <ul>
                <li><strong>Easy:</strong> Making a direct call to an API. Takes 5 minutes and gives immediate gratification.</li>
                <li><strong>Simple:</strong> Having a clean architecture with a single, well-defined point of interaction with external services, managed by an SDK.</li>
            </ul>

            <p>The "easy" path would have led us to a complex, tangled, and fragile system. The "simple" path, while requiring more initial work to configure the SDK, led us to a system much easier to understand, maintain, and extend.</p>

            <p>This decision paid huge dividends almost immediately. When we had to implement memory, tools, and quality gates, we didn't have to build the infrastructure from scratch. We could use the primitives the SDK already offered.</p>

            <div class="key-takeaways-section">
                <h4 class="key-takeaways-title">üìù Chapter Key Takeaways:</h4>
                <p class="takeaway-item">‚úì <strong>Abstract External Dependencies:</strong> Never couple your business logic directly to an external API. Always use an abstraction layer.</p>
                <p class="takeaway-item">‚úì <strong>Think in Terms of "Capabilities", not "API Calls":</strong> The SDK allowed us to stop thinking about "how to format the request for endpoint X" and start thinking about "how can I use this agent's planning capability?"</p>
                <p class="takeaway-item">‚úì <strong>Leverage Existing Primitives:</strong> Before building a complex system (e.g., memory management), check if the SDK you're using already offers a solution. Reinventing the wheel is a classic mistake that leads to technical debt.</p>
            </div>

            <p><strong>Chapter Conclusion</strong></p>

            <p>With the SDK as the backbone of our architecture, we finally had all the pieces to build not just agents, but a real <strong>team</strong>. We had a common language and robust infrastructure.</p>

            <p>We were ready for the next challenge: orchestration. How to make these specialized agents collaborate to achieve a common goal? This brought us to creating the <strong>Executor</strong>, our conductor.</p>
        </div>

        <!-- Reader Tools -->
        <div class="reader-tools" id="readerTools">
            <button class="reader-tools-toggle" onclick="toggleReaderTools()">‚öô</button>
            
            <div class="reader-tool" onclick="toggleTheme()">
                <span class="reader-tool-icon" id="themeIcon">üåô</span>
                <span class="reader-tool-label">Theme</span>
            </div>
            
            <div class="reader-tool" onclick="toggleBookmark()">
                <span class="reader-tool-icon">üîñ</span>
                <span class="reader-tool-label">Bookmark</span>
            </div>
            
            <div class="reader-tool" onclick="showBookmarks()">
                <span class="reader-tool-icon">üìö</span>
                <span class="reader-tool-label">My Bookmarks</span>
            </div>
            
            <div class="language-switcher">
                <select class="language-select" onchange="switchLanguage(this.value)">
                    <option value="en">üá¨üáß EN</option>
                    <option value="it">üáÆüáπ IT</option>
                </select>
            </div>
            
            <div class="reader-tool" onclick="showFontSizeMenu()">
                <span class="reader-tool-icon">üî§</span>
                <span class="reader-tool-label">Font Size</span>
            </div>
        </div>
        
        <!-- Reading Progress -->
        <div class="reading-progress">
            <div class="reading-progress-fill" id="progressFill"></div>
        </div>
        
        <!-- Bookmark Toast -->
        <div class="bookmark-toast" id="bookmarkToast">
            <span id="bookmarkMessage">Bookmark saved!</span>
        </div>

        <!-- Navigation -->
        <div class="chapter-nav-bottom">
            <a href="../drama-parsing-ai-contracts/" class="nav-button">
                ‚Üê Previous: Parsing Drama
            </a>
            <a href="../agent-environment-interactions/" class="nav-button">
                Next: Agent Environment ‚Üí
            </a>
        </div>
        
        <!-- Bookmarks Modal -->
        <div class="bookmarks-modal" id="bookmarksModal" onclick="closeBookmarksModal(event)">
            <div class="bookmarks-content">
                <div class="bookmarks-header">
                    <h3 class="bookmarks-title">üìö My Bookmarks</h3>
                    <button class="close-bookmarks" onclick="closeBookmarksModal()">&times;</button>
                </div>
                <div class="bookmarks-list" id="bookmarksList">
                    <!-- Bookmarks will be populated by JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // Reader Tools JavaScript
        let readerToolsCollapsed = false;
        
        // Initialize reader tools
        document.addEventListener('DOMContentLoaded', function() {
            initializeReaderTools();
            updateReadingProgress();
            loadUserPreferences();
        });
        
        // Toggle reader tools visibility
        function toggleReaderTools() {
            const tools = document.getElementById('readerTools');
            readerToolsCollapsed = !readerToolsCollapsed;
            
            if (readerToolsCollapsed) {
                tools.classList.add('collapsed');
            } else {
                tools.classList.remove('collapsed');
            }
            
            localStorage.setItem('readerToolsCollapsed', readerToolsCollapsed);
        }
        
        // Theme toggle functionality
        function toggleTheme() {
            const body = document.body;
            const themeIcon = document.getElementById('themeIcon');
            const isDarkMode = body.classList.contains('dark-mode');
            
            if (isDarkMode) {
                body.classList.remove('dark-mode');
                themeIcon.textContent = 'üåô';
                localStorage.setItem('theme', 'light');
            } else {
                body.classList.add('dark-mode');
                themeIcon.textContent = '‚òÄÔ∏è';
                localStorage.setItem('theme', 'dark');
            }
        }
        
        // Bookmark functionality
        function toggleBookmark() {
            const currentPage = window.location.pathname;
            const pageTitle = document.querySelector('.chapter-title').textContent;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarks') || '[]');
            const existingIndex = bookmarks.findIndex(b => b.url === currentPage);
            
            if (existingIndex > -1) {
                bookmarks.splice(existingIndex, 1);
                showToast('Bookmark removed!', 'error');
            } else {
                bookmarks.push({
                    url: currentPage,
                    title: pageTitle,
                    timestamp: new Date().toISOString()
                });
                showToast('Bookmark saved!', 'success');
            }
            
            localStorage.setItem('bookmarks', JSON.stringify(bookmarks));
            updateBookmarkButton();
        }
        
        // Language switching
        function switchLanguage(lang) {
            const currentPath = window.location.pathname;
            let newPath;
            
            if (lang === 'it') {
                newPath = currentPath
                    .replace('/en/', '/it/')
                    .replace('core-philosophy-architecture', 'filosofia-core-architettura')
                    .replace('sdk-vs-direct-api-battle', 'sdk-vs-api-battle');
            } else if (lang === 'en') {
                newPath = currentPath
                    .replace('/it/', '/en/')
                    .replace('filosofia-core-architettura', 'core-philosophy-architecture')
                    .replace('sdk-vs-api-battle', 'sdk-vs-direct-api-battle');
            }
            
            if (newPath && newPath !== currentPath) {
                window.location.href = newPath;
            }
        }
        
        // Font size menu
        function showFontSizeMenu() {
            const currentSize = localStorage.getItem('fontSize') || 'medium';
            let newSize;
            
            switch (currentSize) {
                case 'small':
                    newSize = 'medium';
                    break;
                case 'medium':
                    newSize = 'large';
                    break;
                case 'large':
                    newSize = 'small';
                    break;
                default:
                    newSize = 'medium';
            }
            
            setFontSize(newSize);
            localStorage.setItem('fontSize', newSize);
            showToast(`Font size: ${newSize}`, 'success');
        }
        
        // Set font size
        function setFontSize(size) {
            const root = document.documentElement;
            const sizes = {
                'small': '0.9em',
                'medium': '1.0em',
                'large': '1.1em'
            };
            root.style.fontSize = sizes[size];
        }
        
        // Show toast notification
        function showToast(message, type = 'success') {
            const toast = document.getElementById('bookmarkToast');
            const messageEl = document.getElementById('bookmarkMessage');
            
            if (!toast || !messageEl) return;
            
            // Clear any existing timeouts
            if (window.toastTimeout) {
                clearTimeout(window.toastTimeout);
            }
            
            // Reset classes and set message
            toast.classList.remove('show', 'error');
            messageEl.textContent = message;
            
            // Add appropriate classes
            if (type === 'error') {
                toast.classList.add('error');
            }
            
            // Show toast
            toast.classList.add('show');
            
            // Hide after delay
            window.toastTimeout = setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }
        
        // Reading progress
        function updateReadingProgress() {
            const progressFill = document.getElementById('progressFill');
            
            window.addEventListener('scroll', () => {
                const article = document.querySelector('.chapter-content');
                if (!article) return;
                
                const articleTop = article.offsetTop;
                const articleHeight = article.offsetHeight;
                const windowHeight = window.innerHeight;
                const scrollTop = window.pageYOffset;
                
                const progress = Math.min(100, Math.max(0, 
                    ((scrollTop + windowHeight - articleTop) / articleHeight) * 100
                ));
                
                progressFill.style.width = progress + '%';
            });
        }
        
        // Load user preferences
        function loadUserPreferences() {
            // Load theme
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'dark') {
                document.body.classList.add('dark-mode');
                document.getElementById('themeIcon').textContent = '‚òÄÔ∏è';
            }
            
            // Load font size
            const savedFontSize = localStorage.getItem('fontSize');
            if (savedFontSize) {
                setFontSize(savedFontSize);
            }
            
            // Load reader tools state
            const toolsCollapsed = localStorage.getItem('readerToolsCollapsed') === 'true';
            if (toolsCollapsed) {
                document.getElementById('readerTools').classList.add('collapsed');
                readerToolsCollapsed = true;
            }
        }
        
        // Initialize reader tools
        function initializeReaderTools() {
            updateBookmarkButton();
        }
        
        // Update bookmark button state
        function updateBookmarkButton() {
            const currentPage = window.location.pathname;
            const bookmarks = JSON.parse(localStorage.getItem('bookmarks') || '[]');
            const isBookmarked = bookmarks.some(b => b.url === currentPage);
            
            const bookmarkTool = document.querySelector('.reader-tool[onclick*="toggleBookmark"]');
            if (bookmarkTool) {
                bookmarkTool.classList.toggle('active', isBookmarked);
            }
        }
        
        // Show bookmarks modal
        function showBookmarks() {
            const modal = document.getElementById('bookmarksModal');
            const bookmarksList = document.getElementById('bookmarksList');
            const bookmarks = JSON.parse(localStorage.getItem('bookmarks') || '[]');
            
            if (bookmarks.length === 0) {
                bookmarksList.innerHTML = `
                    <div class="empty-bookmarks">
                        <div class="empty-bookmarks-icon">üìö</div>
                        <h3>No bookmarks saved</h3>
                        <p>Start saving your favorite chapters by clicking the bookmark icon üîñ</p>
                    </div>`;
            } else {
                bookmarksList.innerHTML = bookmarks.map(bookmark => `
                    <div class="bookmark-item">
                        <div class="bookmark-info">
                            <a href="${bookmark.url}" class="bookmark-title">${bookmark.title}</a>
                            <div class="bookmark-date">${new Date(bookmark.timestamp).toLocaleDateString()}</div>
                        </div>
                        <div class="bookmark-actions">
                            <button class="bookmark-action" onclick="deleteBookmark('${bookmark.url}')" title="Remove bookmark">üóëÔ∏è</button>
                        </div>
                    </div>
                `).join('');
            }
            
            modal.style.display = 'flex';
            document.body.style.overflow = 'hidden';
        }
        
        // Close bookmarks modal
        function closeBookmarksModal(event) {
            const modal = document.getElementById('bookmarksModal');
            if (modal && (!event || event.target === modal)) {
                modal.style.display = 'none';
                document.body.style.overflow = '';
            }
        }
        
        // Delete bookmark
        function deleteBookmark(url) {
            let bookmarks = JSON.parse(localStorage.getItem('bookmarks') || '[]');
            bookmarks = bookmarks.filter(b => b.url !== url);
            localStorage.setItem('bookmarks', JSON.stringify(bookmarks));
            showToast('Bookmark removed!', 'error');
            showBookmarks(); // Refresh the modal
            updateBookmarkButton();
        }
    </script>

    <!-- Mermaid.js for diagrams -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
    <script>
        mermaid.initialize({ 
            startOnLoad: true,
            theme: 'base',
            themeVariables: {
                primaryColor: '#667eea',
                primaryTextColor: '#2c3e50',
                primaryBorderColor: '#667eea',
                lineColor: '#7f8c8d',
                secondaryColor: '#f8f9fa',
                tertiaryColor: '#ffffff'
            }
        });
    </script>
</body>
</html>