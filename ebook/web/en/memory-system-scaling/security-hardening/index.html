<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enterprise Security Hardening ‚Äì From Trust to Paranoia | Memory System Scaling | AI Team Orchestrator</title>
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="Chapter 40 of AI Team Orchestrator: Enterprise Security Hardening ‚Äì From Trust to Paranoia">
    <meta name="keywords" content="AI agents, AI-driven system, AI architecture, OpenAI SDK, AI team">
    <meta name="author" content="Daniele Pelleri">
    <meta name="robots" content="index, follow">

    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ü§ñ</text></svg>">
    
    <!-- Open Graph -->
    <meta property="og:title" content="Enterprise Security Hardening ‚Äì From Trust to Paranoia">
    <meta property="og:description" content="Chapter 40 of AI Team Orchestrator: Enterprise Security Hardening ‚Äì From Trust to Paranoia">
    <meta property="og:type" content="article">
    <meta property="og:url" content="https://books.danielepelleri.com/en/memory-system-scaling/security-hardening/">
    
    <!-- Canonical -->
    <link rel="canonical" href="https://books.danielepelleri.com/en/memory-system-scaling/security-hardening/">
    <link rel="alternate" hreflang="en" href="https://books.danielepelleri.com/en/memory-system-scaling/security-hardening/">
    <link rel="alternate" hreflang="it" href="https://books.danielepelleri.com/it/memory-system-scaling/enterprise-security-hardening-paranoia/">
    
    <style>
        /* Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            line-height: 1.6;
            color: #2c3e50;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        /* Breadcrumb Navigation */
        .breadcrumb {
            background: rgba(255, 255, 255, 0.9);
            padding: 1rem 2rem;
            border-radius: 10px;
            margin-bottom: 2rem;
            font-size: 0.9rem;
            backdrop-filter: blur(10px);
        }
        
        .breadcrumb a {
            color: #667eea;
            text-decoration: none;
        }
        
        .breadcrumb a:hover {
            text-decoration: underline;
        }
        
        .breadcrumb span {
            color: #7f8c8d;
            margin: 0 0.5rem;
        }
        
        /* Chapter Header */
        .chapter-header {
            background: white;
            padding: 3rem;
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            margin-bottom: 3rem;
            text-align: center;
        }
        
        .chapter-instrument {
            font-size: 4rem;
            margin-bottom: 1rem;
        }
        
        .chapter-meta {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin-bottom: 1rem;
            font-size: 0.9rem;
            color: #7f8c8d;
            flex-wrap: wrap;
        }
        
        .chapter-title {
            font-size: 2.5rem;
            color: #2c3e50;
            margin-bottom: 1rem;
            font-weight: 700;
            line-height: 1.2;
        }
        
        /* Content Styles */
        .chapter-content {
            background: white;
            padding: 3rem;
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            margin-bottom: 3rem;
        }
        
        .chapter-content h3 {
            font-size: 2rem;
            color: #2c3e50;
            margin: 2rem 0 1rem;
            border-bottom: 2px solid #667eea;
            padding-bottom: 0.5rem;
        }
        
        .chapter-content h4 {
            font-size: 1.5rem;
            color: #495057;
            margin: 1.5rem 0 1rem;
        }
        
        .chapter-content p {
            margin-bottom: 1.5rem;
            font-size: 1.1rem;
            line-height: 1.8;
        }
        
        .chapter-content ul, .chapter-content ol {
            margin: 1.5rem 0;
            padding-left: 2rem;
        }
        
        .chapter-content li {
            margin-bottom: 0.5rem;
            font-size: 1.1rem;
            line-height: 1.6;
        }
        
        /* Tables */
        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            margin: 2rem 0;
        }
        
        th, td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid #ecf0f1;
        }
        
        th {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            font-weight: 600;
        }
        
        /* Code Styles */
        pre {
            background: #2d3748;
            color: #e2e8f0;
            padding: 1.5rem;
            border-radius: 8px;
            overflow-x: auto;
            margin: 1.5rem 0;
            font-size: 0.9rem;
        }
        
        code {
            background: #f1f3f4;
            color: #d73a49;
            padding: 0.2rem 0.4rem;
            border-radius: 3px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
        }
        
        pre code {
            background: transparent;
            color: inherit;
            padding: 0;
        }
        
        /* Special Boxes */
        .war-story, .industry-insight, .architecture-section, .key-takeaways-section {
            border-radius: 10px;
            padding: 2rem;
            margin: 2rem 0;
        }
        
        .war-story {
            background: linear-gradient(135deg, #fff3cd, #ffeaa7);
            border-left: 4px solid #856404;
        }
        
        .industry-insight {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border-left: 4px solid #28a745;
        }
        
        .architecture-section {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border: 1px solid #dee2e6;
        }
        
        .key-takeaways-section {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: white;
        }
        
        /* Mermaid Container */
        .mermaid {
            background: #f8f9fa;
            padding: 2rem;
            border-radius: 10px;
            margin: 2rem 0;
            text-align: center;
        }
        
        /* Navigation */
        .chapter-nav-bottom {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 3rem 0;
            gap: 1rem;
            flex-wrap: wrap;
        }
        
        .nav-button {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 1rem 2rem;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            text-decoration: none;
            border-radius: 50px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
        }
        
        .nav-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 40px rgba(102, 126, 234, 0.6);
        }
        
        .nav-button.secondary {
            background: rgba(255, 255, 255, 0.9);
            color: #667eea;
            border: 2px solid #667eea;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .nav-button.secondary:hover {
            background: white;
            box-shadow: 0 15px 40px rgba(0,0,0,0.15);
        }
        
        /* War Story Icon Styling */
        .war-story-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }
        
        .war-story-icon {
            width: 1.5rem;
            height: 1.5rem;
            flex-shrink: 0;
            color: #856404;
        }
        
        /* Architecture Section Styling */
        .architecture-title {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        
        .architecture-icon {
            width: 2rem;
            height: 2rem;
            flex-shrink: 0;
            color: #667eea;
        }
        
        /* Insight Icon Styling */
        .insight-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }
        
        .insight-icon {
            width: 1.8rem;
            height: 1.8rem;
            flex-shrink: 0;
            color: #28a745;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }
            
            .chapter-header,
            .chapter-content {
                padding: 2rem;
            }
            
            .chapter-title {
                font-size: 2rem;
            }
            
            .chapter-nav-bottom {
                flex-direction: column;
                text-align: center;
            }
        }
        
        /* PDF/Print Specific Styles - Hide UI Elements */
        @media print {
            .bookmarks-modal,
            .reader-tools,
            .bookmark-toast,
            #bookmarksModal,
            #bookmarkToast {
                display: none !important;
                visibility: hidden !important;
                opacity: 0 !important;
                z-index: -1000 !important;
            }
        }
            </style>
    
    <style>
        /* Reader Tools */
        .reader-tools {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .tool-button {
            background: rgba(255, 255, 255, 0.9);
            border: none;
            border-radius: 50%;
            width: 45px;
            height: 45px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 18px;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .tool-button:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
        }
        
        /* Bookmark Modal */
        .bookmarks-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            z-index: 10000;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background: white;
            padding: 2rem;
            border-radius: 20px;
            max-width: 500px;
            width: 90%;
            max-height: 70vh;
            overflow-y: auto;
            position: relative;
        }
        
        .close-modal {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #999;
        }
        
        .close-modal:hover {
            color: #333;
        }
        
        .bookmark-item {
            padding: 0.5rem 0;
            border-bottom: 1px solid #eee;
        }
        
        .bookmark-item:last-child {
            border-bottom: none;
        }
        
        .bookmark-link {
            color: #667eea;
            text-decoration: none;
        }
        
        .bookmark-link:hover {
            text-decoration: underline;
        }
        
        /* Reading Progress Bar */
        .reading-progress {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: rgba(102, 126, 234, 0.2);
            z-index: 999;
        }
        
        .reading-progress::before {
            content: '';
            display: block;
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            transform-origin: left;
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }
        
        /* Dark Mode */
        body.dark-mode {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: #ecf0f1;
        }
        
        body.dark-mode .chapter-header,
        body.dark-mode .chapter-content,
        body.dark-mode .breadcrumb {
            background: rgba(52, 73, 94, 0.8);
            color: #ecf0f1;
        }
        
        /* Toast Notifications */
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: white;
            padding: 1rem 2rem;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            transform: translateX(400px);
            transition: transform 0.3s ease;
            z-index: 10001;
        }
        
        .toast.show {
            transform: translateX(0);
        }
        
        /* PDF/Print Specific Styles - Hide UI Elements */
        @media print {
            .bookmarks-modal,
            .reader-tools,
            .bookmark-toast,
            #bookmarksModal,
            #bookmarkToast {
                display: none !important;
                visibility: hidden !important;
                opacity: 0 !important;
                z-index: -1000 !important;
            }
        }
            </style>
</head>
<body>
    <!-- Reading Progress Bar -->
    <div class="reading-progress" id="readingProgress"></div>
    
    <!-- Reader Tools -->
    <div class="reader-tools">
        <button class="tool-button" onclick="addBookmark()" title="My Bookmarks">üìö</button>
        <button class="tool-button" onclick="toggleTheme()" title="Theme">üé®</button>
        <button class="tool-button" onclick="increaseFontSize()" title="Font Size +">A+</button>
        <button class="tool-button" onclick="decreaseFontSize()" title="Font Size -">A-</button>
    </div>
    
    <!-- Bookmark Modal -->
    <div id="bookmarksModal" class="bookmarks-modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeBookmarksModal()">&times;</span>
            <h3>üìö My Bookmarks</h3>
            <div id="bookmarksList">
                <!-- Bookmarks will be populated by JavaScript -->
            </div>
        </div>
    </div>    <div class="container">
        <!-- Breadcrumb -->
        <nav class="breadcrumb">
            <a href="../../ai-team-orchestrator.html">üè† AI Team Orchestrator</a>
            <span>‚Ä∫</span>
            <a href="../">üé≠ Memory System Scaling</a>
            <span>‚Ä∫</span>
            <span>Enterprise Security Hardening ‚Äì From Trust to Paranoia</span>
        </nav>

        <!-- Chapter Header -->
        <header class="chapter-header">
            <div class="chapter-instrument">üé≠</div>
            <div class="chapter-meta">
                <span>üé≠ Movement 4 of 4</span>
                <span>üìñ Chapter 40 of 42</span>
                <span>‚è±Ô∏è ~13 min read</span>
                <span>üìä Level: Expert</span>
            </div>
            <h1 class="chapter-title">Enterprise Security Hardening ‚Äì From Trust to Paranoia</h1>
        </header>

        <!-- Main Content -->
        <article class="chapter-content">
<p>The load testing shock had solved our scalability problems, but it had also attracted the attention of much more demanding enterprise clients. The first signal arrived via email at 09:30 on August 25th:</p>

<p><em>"Hi, we're very interested in your platform for our 500+ person team. Before proceeding, we would need a complete security review, SOC 2 certification, GDPR compliance audit, and third-party penetration testing. When can we schedule this?"</em></p>

<p><strong>Sender:</strong> Head of IT Security, Fortune 500 Financial Services Company</p>

<p>My first thought was: "Shit, we're not ready for this."</p>

<h3>The Reality Check: From Startup to Enterprise Target</h3>

<p>Until that moment, our security was typical startup security: <strong>"Functional but not paranoid"</strong>. We had authentication, basic authorization, and HTTPS. For SMB clients, it was fine. For enterprise finance? It was like showing up to a wedding in gym clothes.</p>

<p><em>Initial Security Assessment (August 25th):</em></p>

<pre><code class="language-text">CURRENT SECURITY POSTURE ASSESSMENT:

‚úÖ BASIC (Adequate for SMB):
- User authentication (email/password)
- HTTPS everywhere  
- Basic input validation
- Environment variables for secrets

‚ùå MISSING (Required for Enterprise):
- Multi-factor authentication (MFA)
- Granular role-based access control (RBAC)
- Data encryption at rest
- Comprehensive audit logging
- SOC 2 compliance framework
- Penetration testing
- Incident response procedures
- Data retention/deletion policies

SECURITY MATURITY SCORE: 3/10 (Enterprise requirement: 8+/10)</code></pre>

<p><strong>The Brutal Insight:</strong> Enterprise security isn't a feature you add later ‚Äì it's a mindset that permeates every architectural decision. We had to rethink the system from scratch with a <strong>security-first approach</strong>.</p>

<h3>Phase 1: Authentication Revolution ‚Äì From Passwords to Zero Trust</h3>

<p>The first problem to solve was authentication. Enterprise clients wanted <strong>Multi-Factor Authentication (MFA)</strong>, <strong>Single Sign-On (SSO)</strong>, and integration with their existing <strong>Active Directory</strong>.</p>

<p><em>Reference code: <code>backend/services/enterprise_auth_manager.py</code></em></p>

<pre><code class="language-python">class EnterpriseAuthManager:
    """
    Enterprise-grade authentication system with MFA, SSO, and Zero Trust principles
    """
    
    def __init__(self):
        self.mfa_provider = MFAProvider()
        self.sso_integrator = SSOIntegrator()
        self.directory_connector = DirectoryConnector()
        self.zero_trust_enforcer = ZeroTrustEnforcer()
        self.audit_logger = SecurityAuditLogger()
        
    async def authenticate_user(
        self,
        auth_request: AuthenticationRequest,
        security_context: SecurityContext
    ) -> AuthenticationResult:
        """
        Multi-layered authentication with risk assessment and adaptive security
        """
        # 1. Risk Assessment: Analyze authentication context
        risk_assessment = await self._assess_authentication_risk(auth_request, security_context)
        
        # 2. Primary Authentication (password, SSO, or certificate)
        primary_auth_result = await self._perform_primary_authentication(auth_request)
        if not primary_auth_result.success:
            await self._log_failed_authentication(auth_request, "primary_auth_failure")
            return AuthenticationResult.failure("Invalid credentials")
        
        # 3. Multi-Factor Authentication (adaptive based on risk)
        if risk_assessment.requires_mfa or auth_request.force_mfa:
            mfa_result = await self._perform_mfa_challenge(
                primary_auth_result.user,
                risk_assessment.recommended_mfa_strength
            )
            if not mfa_result.success:
                await self._log_failed_authentication(auth_request, "mfa_failure")
                return AuthenticationResult.failure("MFA verification failed")
        
        # 4. Device Trust Verification
        device_trust = await self._verify_device_trust(
            auth_request.device_fingerprint,
            primary_auth_result.user
        )
        
        # 5. Zero Trust Context Evaluation
        zero_trust_decision = await self.zero_trust_enforcer.evaluate_access_request(
            user=primary_auth_result.user,
            device_trust=device_trust,
            risk_assessment=risk_assessment,
            requested_resources=auth_request.requested_scopes
        )
        
        if zero_trust_decision.action == ZeroTrustAction.DENY:
            await self._log_failed_authentication(auth_request, f"zero_trust_denial: {zero_trust_decision.reason}")
            return AuthenticationResult.failure(f"Access denied: {zero_trust_decision.reason}")
        
        # 6. Generate secure session with appropriate permissions
        session_token = await self._generate_secure_session_token(
            user=primary_auth_result.user,
            permissions=zero_trust_decision.granted_permissions,
            device_trust=device_trust,
            session_constraints=zero_trust_decision.session_constraints
        )
        
        # 7. Audit successful authentication
        await self._log_successful_authentication(primary_auth_result.user, auth_request, risk_assessment)
        
        return AuthenticationResult.success(
            user=primary_auth_result.user,
            session_token=session_token,
            granted_permissions=zero_trust_decision.granted_permissions,
            session_expires_at=session_token.expires_at,
            security_warnings=zero_trust_decision.security_warnings
        )
    
    async def _assess_authentication_risk(
        self,
        auth_request: AuthenticationRequest,
        security_context: SecurityContext
    ) -> RiskAssessment:
        """
        Comprehensive risk assessment for adaptive security
        """
        risk_factors = {}
        
        # Geographic risk: Login from unusual location?
        geographic_risk = await self._assess_geographic_risk(
            auth_request.source_ip,
            auth_request.user_id
        )
        risk_factors["geographic"] = geographic_risk
        
        # Device risk: Known device or new device?
        device_risk = await self._assess_device_risk(
            auth_request.device_fingerprint,
            auth_request.user_id
        )
        risk_factors["device"] = device_risk
        
        # Behavioral risk: Unusual access patterns?
        behavioral_risk = await self._assess_behavioral_risk(
            auth_request.user_id,
            auth_request.timestamp,
            auth_request.user_agent
        )
        risk_factors["behavioral"] = behavioral_risk
        
        # Network risk: Suspicious IP, VPN, Tor?
        network_risk = await self._assess_network_risk(auth_request.source_ip)
        risk_factors["network"] = network_risk
        
        # Historical risk: Recent security incidents?
        historical_risk = await self._assess_historical_risk(auth_request.user_id)
        risk_factors["historical"] = historical_risk
        
        # Calculate composite risk score
        composite_risk_score = self._calculate_composite_risk_score(risk_factors)
        
        return RiskAssessment(
            composite_score=composite_risk_score,
            risk_factors=risk_factors,
            requires_mfa=composite_risk_score > 0.6,
            recommended_mfa_strength=self._determine_mfa_strength(composite_risk_score),
            security_recommendations=self._generate_security_recommendations(risk_factors)
        )</code></pre>

<h3>Phase 2: Data Encryption ‚Äì Protecting Others' Secrets</h3>

<p>With enterprise-ready authentication, the next step was <strong>data encryption</strong>. Enterprise clients wanted guarantees that their data was <strong>encrypted at rest</strong>, <strong>encrypted in transit</strong>, and <strong>encrypted in processing</strong> when possible.</p>

<pre><code class="language-python">class EnterpriseDataProtectionManager:
    """
    Comprehensive data protection with encryption, key management, and data loss prevention
    """
    
    def __init__(self):
        self.encryption_engine = AESGCMEncryptionEngine()
        self.key_management = AWSKMSKeyManager()  # Enterprise KMS integration
        self.data_classifier = DataClassifier()
        self.dlp_engine = DataLossPrevention()
        
    async def protect_sensitive_data(
        self,
        data: Any,
        data_context: DataContext,
        protection_requirements: ProtectionRequirements
    ) -> ProtectedData:
        """
        Intelligent data protection based on classification and requirements
        """
        # 1. Classify data sensitivity
        data_classification = await self.data_classifier.classify_data(data, data_context)
        
        # 2. Determine protection strategy based on classification
        protection_strategy = await self._determine_protection_strategy(
            data_classification,
            protection_requirements
        )
        
        # 3. Apply appropriate encryption
        encrypted_data = await self._apply_encryption(
            data,
            protection_strategy.encryption_level,
            data_context
        )
        
        # 4. Generate data protection metadata
        protection_metadata = await self._generate_protection_metadata(
            data_classification,
            protection_strategy,
            encrypted_data
        )
        
        # 5. Store in protected format
        protected_data = ProtectedData(
            encrypted_payload=encrypted_data.ciphertext,
            encryption_metadata=encrypted_data.metadata,
            data_classification=data_classification,
            protection_metadata=protection_metadata,
            access_control_list=await self._generate_access_control_list(data_context)
        )
        
        # 6. Audit data protection
        await self._audit_data_protection(protected_data, data_context)
        
        return protected_data
    
    async def _determine_protection_strategy(
        self,
        classification: DataClassification,
        requirements: ProtectionRequirements
    ) -> ProtectionStrategy:
        """
        Choose optimal protection strategy based on data sensitivity and requirements
        """
        if classification.sensitivity == SensitivityLevel.TOP_SECRET:
            # Highest protection: AES-256, separate keys per record
            return ProtectionStrategy(
                encryption_level=EncryptionLevel.AES_256_RECORD_LEVEL,
                key_rotation_frequency=KeyRotationFrequency.DAILY,
                backup_encryption=True,
                network_encryption=NetworkEncryption.END_TO_END,
                memory_protection=MemoryProtection.ENCRYPTED_SWAP
            )
            
        elif classification.sensitivity == SensitivityLevel.CONFIDENTIAL:
            # High protection: AES-256, per-workspace keys
            return ProtectionStrategy(
                encryption_level=EncryptionLevel.AES_256_WORKSPACE_LEVEL,
                key_rotation_frequency=KeyRotationFrequency.WEEKLY,
                backup_encryption=True,
                network_encryption=NetworkEncryption.TLS_1_3,
                memory_protection=MemoryProtection.STANDARD
            )
            
        elif classification.sensitivity == SensitivityLevel.INTERNAL:
            # Medium protection: AES-256, per-tenant keys
            return ProtectionStrategy(
                encryption_level=EncryptionLevel.AES_256_TENANT_LEVEL,
                key_rotation_frequency=KeyRotationFrequency.MONTHLY,
                backup_encryption=True,
                network_encryption=NetworkEncryption.TLS_1_3,
                memory_protection=MemoryProtection.STANDARD
            )
            
        else:
            # Basic protection: AES-256, system-wide key
            return ProtectionStrategy(
                encryption_level=EncryptionLevel.AES_256_SYSTEM_LEVEL,
                key_rotation_frequency=KeyRotationFrequency.QUARTERLY,
                backup_encryption=True,
                network_encryption=NetworkEncryption.TLS_1_2,
                memory_protection=MemoryProtection.STANDARD
            )</code></pre>

<h3>"War Story": The GDPR Compliance Emergency</h3>

<p>In September, a potential European client asked us for full GDPR compliance before signing a ‚Ç¨200K contract. We had 3 weeks to implement everything.</p>

<p>The problem was that GDPR isn't just encryption ‚Äì it's <strong>data lifecycle management</strong>, <strong>right to be forgotten</strong>, <strong>data portability</strong>, and <strong>consent management</strong>. All systems we didn't have.</p>

<pre><code class="language-python">class GDPRComplianceManager:
    """
    Comprehensive GDPR compliance with data lifecycle, consent management, and user rights
    """
    
    def __init__(self):
        self.consent_manager = ConsentManager()
        self.data_inventory = DataInventoryManager()
        self.right_to_be_forgotten = RightToBeForgottenEngine()
        self.data_portability = DataPortabilityEngine()
        self.audit_trail = GDPRAuditTrail()
        
    async def handle_data_subject_request(
        self,
        request: DataSubjectRequest
    ) -> DataSubjectRequestResult:
        """
        Handle GDPR data subject requests (access, rectification, erasure, portability)
        """
        # 1. Verify requestor identity
        identity_verification = await self._verify_data_subject_identity(request)
        if not identity_verification.verified:
            return DataSubjectRequestResult.failure(
                "Identity verification failed",
                required_documents=identity_verification.required_documents
            )
        
        # 2. Locate all data for this subject
        data_inventory = await self.data_inventory.find_all_user_data(request.user_id)
        
        # 3. Process request based on type
        if request.request_type == DataSubjectRequestType.ACCESS:
            return await self._handle_data_access_request(request, data_inventory)
            
        elif request.request_type == DataSubjectRequestType.RECTIFICATION:
            return await self._handle_data_rectification_request(request, data_inventory)
            
        elif request.request_type == DataSubjectRequestType.ERASURE:
            return await self._handle_data_erasure_request(request, data_inventory)
            
        elif request.request_type == DataSubjectRequestType.PORTABILITY:
            return await self._handle_data_portability_request(request, data_inventory)
            
        else:
            return DataSubjectRequestResult.failure(f"Unsupported request type: {request.request_type}")
    
    async def _handle_data_erasure_request(
        self,
        request: DataSubjectRequest,
        data_inventory: DataInventory
    ) -> DataSubjectRequestResult:
        """
        Handle "Right to be Forgotten" requests - complex cascading deletion
        """
        # 1. Check if erasure is legally possible
        erasure_assessment = await self._assess_erasure_legality(request, data_inventory)
        if not erasure_assessment.erasure_permitted:
            return DataSubjectRequestResult.partial_success(
                message="Some data cannot be erased due to legal obligations",
                retained_data_reason=erasure_assessment.retention_reasons,
                erased_data_categories=[]
            )
        
        # 2. Plan cascading deletion (maintain referential integrity)
        deletion_plan = await self._create_deletion_plan(data_inventory)
        
        # 3. Execute deletion in safe order
        deletion_results = []
        for deletion_step in deletion_plan.steps:
            try:
                # Backup data before deletion (for audit/recovery)
                backup_result = await self._backup_data_for_audit(deletion_step.data_items)
                
                # Execute deletion
                step_result = await self._execute_deletion_step(deletion_step)
                
                # Verify deletion completed
                verification_result = await self._verify_deletion_completion(deletion_step)
                
                deletion_results.append(DeletionStepResult(
                    step=deletion_step,
                    backup_location=backup_result.backup_location,
                    deletion_confirmed=verification_result.confirmed,
                    items_deleted=step_result.items_deleted
                ))
                
            except Exception as e:
                # Rollback partial deletion
                await self._rollback_partial_deletion(deletion_results)
                return DataSubjectRequestResult.failure(
                    f"Deletion failed at step {deletion_step.step_name}: {e}"
                )
        
        # 4. Update consent records
        await self.consent_manager.record_data_erasure(request.user_id, deletion_results)
        
        # 5. Audit trail
        await self.audit_trail.record_erasure_completion(request, deletion_results)
        
        return DataSubjectRequestResult.success(
            message=f"Data erasure completed successfully",
            affected_data_categories=[r.step.data_category for r in deletion_results],
            deletion_completion_date=datetime.utcnow(),
            audit_reference=await self._generate_audit_reference(request, deletion_results)
        )</code></pre>

<h3>Phase 3: Security Monitoring ‚Äì The SOC That Never Sleeps</h3>

<p>With encryption and GDPR in place, we needed <strong>continuous security monitoring</strong>. Enterprise clients wanted <strong>SIEM integration</strong>, <strong>threat detection</strong>, and automated <strong>incident response</strong>.</p>

<pre><code class="language-python">class EnterpriseSIEMIntegration:
    """
    Security Information and Event Management integration
    for continuous threat detection and incident response
    """
    
    def __init__(self):
        self.threat_detector = AIThreatDetector()
        self.incident_responder = AutomatedIncidentResponder()
        self.siem_forwarder = SIEMEventForwarder()
        self.behavioral_analyzer = UserBehaviorAnalyzer()
        
    async def continuous_security_monitoring(self) -> None:
        """
        24/7 security monitoring with AI-powered threat detection
        """
        while True:
            try:
                # 1. Collect security events from all sources
                security_events = await self._collect_security_events()
                
                # 2. Analyze events for threats
                threat_analysis = await self.threat_detector.analyze_events(security_events)
                
                # 3. Detect behavioral anomalies
                behavioral_anomalies = await self.behavioral_analyzer.detect_anomalies(security_events)
                
                # 4. Correlate threats and anomalies
                correlated_incidents = await self._correlate_security_signals(
                    threat_analysis.detected_threats,
                    behavioral_anomalies
                )
                
                # 5. Auto-respond to confirmed incidents
                for incident in correlated_incidents:
                    if incident.confidence > 0.8 and incident.severity >= SeverityLevel.HIGH:
                        await self.incident_responder.auto_respond_to_incident(incident)
                
                # 6. Forward all events to customer SIEM
                await self.siem_forwarder.forward_events(security_events, threat_analysis)
                
                # 7. Generate security dashboard updates
                await self._update_security_dashboard(threat_analysis, behavioral_anomalies)
                
            except Exception as e:
                logger.error(f"Security monitoring error: {e}")
                await self._alert_security_team("monitoring_system_error", str(e))
            
            await asyncio.sleep(30)  # Monitor every 30 seconds
    
    async def _correlate_security_signals(
        self,
        detected_threats: List[DetectedThreat],
        behavioral_anomalies: List[BehavioralAnomaly]
    ) -> List[SecurityIncident]:
        """
        AI-powered correlation of security signals into actionable incidents
        """
        correlation_prompt = f"""
        Analyze these security signals and identify significant incident patterns.
        
        DETECTED THREATS ({len(detected_threats)}):
        {self._format_threats_for_analysis(detected_threats)}
        
        BEHAVIORAL ANOMALIES ({len(behavioral_anomalies)}):
        {self._format_anomalies_for_analysis(behavioral_anomalies)}
        
        Identify:
        1. Coordinated attack patterns (multiple signals pointing to same attacker)
        2. Privilege escalation attempts (behavioral + access anomalies)
        3. Data exfiltration patterns (unusual data access + network activity)
        4. Account compromise indicators (authentication + behavioral anomalies)
        
        For each identified incident, specify:
        - Confidence level (0.0-1.0)
        - Severity level (LOW/MEDIUM/HIGH/CRITICAL)
        - Affected assets
        - Recommended immediate actions
        - Timeline of events
        """
        
        correlation_response = await self.ai_pipeline.execute_pipeline(
            PipelineStepType.SECURITY_CORRELATION_ANALYSIS,
            {"prompt": correlation_prompt},
            {"threats_count": len(detected_threats), "anomalies_count": len(behavioral_anomalies)}
        )
        
        return [SecurityIncident.from_ai_analysis(incident_data) for incident_data in correlation_response.get("incidents", [])]</code></pre>

<h3>The Penetration Testing Gauntlet</h3>

<p>The moment of truth came when potential enterprise clients hired a security firm to do <strong>penetration testing</strong> of our system.</p>

<p><em>Pen Test Date: October 5th</em></p>

<p>For 3 days, professional ethical hackers attempted to penetrate every aspect of our system. The results were... educational.</p>

<p><em>Penetration Test Results Summary:</em></p>

<pre><code class="language-text">PENETRATION TEST RESULTS (3-day assessment):

üî¥ CRITICAL FINDINGS: 2
- SQL injection possibility in legacy API endpoint
- Insufficient session timeout allowing token replay attacks

üü† HIGH FINDINGS: 5  
- Missing rate limiting on password reset functionality
- Inadequate input sanitization in user-generated content
- Weak encryption key derivation in one legacy module
- Information disclosure in error messages
- Missing security headers on some endpoints

üü° MEDIUM FINDINGS: 12
- Various input validation improvements needed
- Logging insufficient for forensic analysis
- Some dependencies with known vulnerabilities
- Suboptimal security configurations

‚úÖ POSITIVE FINDINGS:
- Overall architecture well-designed
- Authentication system robust
- Data encryption properly implemented  
- GDPR compliance well-architected
- Incident response procedures solid

OVERALL SECURITY SCORE: 7.2/10 (Acceptable for enterprise, needs improvements)</code></pre>

<h3>Security Hardening Sprint: 72 Hours to Fix Everything</h3>

<p>With the pen test results in hand, we had 72 hours to fix all critical and high findings before the final security review.</p>

<pre><code class="language-python">class EmergencySecurityHardening:
    """
    Rapid security hardening for critical vulnerabilities
    """
    
    async def fix_critical_vulnerabilities(
        self,
        vulnerabilities: List[SecurityVulnerability]
    ) -> SecurityHardeningResult:
        """
        Emergency patching of critical security vulnerabilities
        """
        hardening_results = []
        
        for vulnerability in vulnerabilities:
            if vulnerability.severity == SeverityLevel.CRITICAL:
                # Critical vulnerabilities get immediate attention
                fix_result = await self._apply_critical_fix(vulnerability)
                hardening_results.append(fix_result)
                
                # Immediate verification
                verification_result = await self._verify_vulnerability_fixed(vulnerability, fix_result)
                if not verification_result.confirmed_fixed:
                    logger.critical(f"Critical vulnerability {vulnerability.id} not properly fixed!")
                    raise SecurityHardeningException(f"Failed to fix critical vulnerability: {vulnerability.id}")
        
        return SecurityHardeningResult(
            vulnerabilities_addressed=len(hardening_results),
            critical_fixes_applied=[r for r in hardening_results if r.vulnerability.severity == SeverityLevel.CRITICAL],
            verification_passed=all(r.verification_confirmed for r in hardening_results),
            hardening_completion_time=datetime.utcnow()
        )
    
    async def _apply_critical_fix(
        self,
        vulnerability: SecurityVulnerability
    ) -> SecurityFixResult:
        """
        Apply specific fix for critical vulnerability
        """
        if vulnerability.vulnerability_type == VulnerabilityType.SQL_INJECTION:
            # Fix SQL injection with parameterized queries
            return await self._fix_sql_injection(vulnerability)
            
        elif vulnerability.vulnerability_type == VulnerabilityType.SESSION_REPLAY:
            # Fix session replay with proper token rotation
            return await self._fix_session_replay(vulnerability)
            
        elif vulnerability.vulnerability_type == VulnerabilityType.PRIVILEGE_ESCALATION:
            # Fix privilege escalation with proper access controls
            return await self._fix_privilege_escalation(vulnerability)
            
        else:
            # Generic security fix
            return await self._apply_generic_security_fix(vulnerability)</code></pre>

<h3>Production Results: From Vulnerable to Fortress</h3>

<p>After 6 weeks of enterprise security hardening:</p>

<table>
<thead>
<tr>
<th>Security Metric</th>
<th>Pre-Hardening</th>
<th>Post-Hardening</th>
<th>Improvement</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Penetration Test Score</strong></td>
<td>Unknown (likely 4/10)</td>
<td>8.7/10</td>
<td><strong>+117% security posture</strong></td>
</tr>
<tr>
<td><strong>GDPR Compliance</strong></td>
<td>0% compliant</td>
<td>98% compliant</td>
<td><strong>Full compliance achieved</strong></td>
</tr>
<tr>
<td><strong>SOC 2 Readiness</strong></td>
<td>0% ready</td>
<td>85% ready</td>
<td><strong>Enterprise audit ready</strong></td>
</tr>
<tr>
<td><strong>Security Incidents (detected)</strong></td>
<td>0 (no monitoring)</td>
<td>23/month (early detection)</td>
<td><strong>Proactive threat detection</strong></td>
</tr>
<tr>
<td><strong>Data Breach Risk</strong></td>
<td>High (unprotected)</td>
<td>Low (multi-layer protection)</td>
<td><strong>95% risk reduction</strong></td>
</tr>
<tr>
<td><strong>Enterprise Sales Cycle</strong></td>
<td>Blocked by security</td>
<td>3 weeks average</td>
<td><strong>Security enabler not blocker</strong></td>
</tr>
</tbody>
</table>

<h3>The Security-Performance Paradox</h3>

<p>An important lesson we learned is that enterprise security has a hidden <strong>performance cost</strong>:</p>

<p><strong>Security Overhead Measurements:</strong>
- <strong>Authentication</strong>: +200ms per request (MFA, risk assessment)
- <strong>Encryption</strong>: +50ms per data operation (encryption/decryption)
- <strong>Audit Logging</strong>: +30ms per action (comprehensive logging)
- <strong>Access Control</strong>: +100ms per permission check (granular RBAC)</p>

<p><strong>Total Security Tax: ~380ms per user interaction</strong></p>

<p>But we also discovered that enterprise customers <strong>value security over speed</strong>. A secure system with 1.5s latency was preferable to a fast but vulnerable system with 0.5s latency.</p>

<h3>The Cultural Transformation: From "Move Fast" to "Move Secure"</h3>

<p>Security hardening forced us to change our company culture from <strong>"move fast and break things"</strong> to <strong>"move secure and protect things"</strong>.</p>

<p><strong>Cultural Changes Implemented:</strong>
1. <strong>Mandatory Security Review</strong>: Every feature goes through security review before deployment
2. <strong>Standard Threat Modeling</strong>: Every new functionality is analyzed for threat vectors
3. <strong>Incident Response Drills</strong>: Monthly security incident simulations
4. <strong>Security Champions Program</strong>: Every team has a security champion
5. <strong>Compliance-First Development</strong>: GDPR/SOC2 considerations in every decision</p>

<div class="key-takeaways-section">
    <h4 class="key-takeaways-title">üìù Key Takeaways from this Chapter:</h4>
    <div class="key-takeaways-content"><p class="takeaway-item">‚úì <strong>Enterprise Security is a Mindset Shift:</strong> From functional security to paranoid security - assume everything will be attacked.</p>
<p class="takeaway-item">‚úì <strong>Security Has Performance Costs:</strong> Every security layer adds latency, but enterprise customers value security over speed.</p>
<p class="takeaway-item">‚úì <strong>GDPR is More Than Encryption:</strong> Data lifecycle, consent management, and user rights require comprehensive system redesign.</p>
<p class="takeaway-item">‚úì <strong>Penetration Testing Reveals Truth:</strong> Your security is only as strong as external attackers say it is, not as strong as you think.</p>
<p class="takeaway-item">‚úì <strong>Security Culture Transformation Required:</strong> Team culture must shift from "move fast" to "move secure" for enterprise readiness.</p>
<p class="takeaway-item">‚úì <strong>Compliance is a Competitive Advantage:</strong> SOC 2 and GDPR compliance become sales enablers, not blockers, in enterprise markets.</p>
    </div>
</div>

<p><strong>Chapter Conclusion</strong></p>

<p>Enterprise Security Hardening transformed us from an agile but vulnerable startup to an enterprise-ready and secure platform. But more importantly, it taught us that <strong>security isn't a feature you add</strong> ‚Äì it's a <strong>philosophy you embrace</strong> in every decision you make.</p>

<div class="war-story" style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 25px; border-radius: 15px; margin: 25px 0; box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);">
    <div style="display: flex; align-items: center; margin-bottom: 15px;">
        <svg style="width: 28px; height: 28px; margin-right: 12px; fill: #FFD700;" viewBox="0 0 24 24">
            <path d="M12,2A2,2 0 0,1 14,4V8H18A2,2 0 0,1 20,10V19A2,2 0 0,1 18,21H6A2,2 0 0,1 4,19V10C4,8.89 4.89,8 6,8H10V4A2,2 0 0,1 12,2M12,4V8H14V4H12Z"/>
        </svg>
        <h4 style="margin: 0; font-size: 1.3em;">üíº The Sales Cycles of Agentic Systems</h4>
    </div>
    <div style="font-size: 1.1em; line-height: 1.6;">
        <p style="margin: 0 0 15px 0;">
            <strong>Tomasz Tunguz</strong> observes that selling agentic systems differs from traditional software: <em>"There isn't a static checklist of features to tick off, but a continuum of performance"</em>. Enterprise buyers want to see how the AI behaves on <strong>their specific data</strong>, not just generic benchmarks.
        </p>
        
        <p style="margin: 0 0 15px 0;">
            <strong>Implications for sales cycles:</strong> Deep PoCs become mandatory, longer trial periods (to observe autonomous behaviors), and the need to demonstrate transparency and kill-switches for critical systems. Long term, Tunguz predicts industry standards or "Gartner for Agentic AI" that certify these systems.
        </p>
        
        <p style="margin: 0; font-style: italic;">
            <strong>Lesson learned:</strong> Designing modular architecture (as in our book) facilitates fine-tuning and personalized demos. Logging, explainability and circuit breakers aren't just technical robustness ‚Äì they're <strong>requirements for passing enterprise due diligence</strong>.
        </p>
    </div>
</div>

<p>With the system now secure, compliant, and audit-ready, we were prepared for the final challenge of our journey: <strong>Global Scale Architecture</strong>. Because it's not enough to have a system that works for 1,000 users in Italy ‚Äì it must work for 100,000 users distributed across 50 countries, each with their own privacy laws, network latencies, and cultural expectations.</p>

<p>The road to global domination was paved with technical challenges we would have to conquer one timezone at a time.</p>
            </div>

            
        </article>

        <!-- Bottom Navigation -->
        <nav class="chapter-nav-bottom">
            <a href="../load-testing-shock/" class="nav-button secondary">‚Üê Previous Chapter</a>
            <a href="../global-scale/" class="nav-button">Next Chapter ‚Üí</a>
        </nav>
    </div>

    <!-- Mermaid.js for diagrams -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
    <script>
        mermaid.initialize({ 
            startOnLoad: true,
            theme: 'base',
            themeVariables: {
                primaryColor: '#667eea',
                primaryTextColor: '#2c3e50',
                primaryBorderColor: '#667eea',
                lineColor: '#7f8c8d',
                secondaryColor: '#f8f9fa',
                tertiaryColor: '#ffffff'
            }
        });
    </script>

    <!-- Prism.js for code highlighting -->
    <link href="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/themes/prism-tomorrow.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>

    <!-- Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-VEGK4VZMG0"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-VEGK4VZMG0');
        
        gtag('event', 'chapter_start', {
            'chapter_title': 'Enterprise Security Hardening ‚Äì From Trust to Paranoia',
            'movement': 'memory-system-scaling',
            'chapter_number': 40
        });
    </script>
</body>
    
    <script>
        // Reading Progress
        function updateReadingProgress() {
            const article = document.querySelector('.chapter-content');
            const progress = document.getElementById('readingProgress');
            
            if (article && progress) {
                const articleTop = article.offsetTop;
                const articleHeight = article.offsetHeight;
                const windowTop = window.pageYOffset;
                const windowHeight = window.innerHeight;
                
                const articleBottom = articleTop + articleHeight;
                const windowBottom = windowTop + windowHeight;
                
                let progressPercentage = 0;
                
                if (windowTop >= articleTop && windowTop <= articleBottom) {
                    progressPercentage = ((windowTop - articleTop) / articleHeight) * 100;
                } else if (windowBottom >= articleBottom) {
                    progressPercentage = 100;
                }
                
                progress.style.transform = `scaleX(${Math.min(progressPercentage / 100, 1)})`;
            }
        }
        
        window.addEventListener('scroll', updateReadingProgress);
        window.addEventListener('load', updateReadingProgress);
        
        // Font Size Controls
        let currentFontSize = 1.1;
        
        function increaseFontSize() {
            currentFontSize = Math.min(currentFontSize + 0.1, 2.0);
            applyFontSize();
        }
        
        function decreaseFontSize() {
            currentFontSize = Math.max(currentFontSize - 0.1, 0.8);
            applyFontSize();
        }
        
        function applyFontSize() {
            const content = document.querySelector('.chapter-content');
            if (content) {
                const paragraphs = content.querySelectorAll('p, li');
                paragraphs.forEach(p => {
                    p.style.fontSize = currentFontSize + 'rem';
                });
            }
            localStorage.setItem('fontSize', currentFontSize.toString());
        }
        
        // Theme Toggle
        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
            const isDark = document.body.classList.contains('dark-mode');
            localStorage.setItem('darkMode', isDark.toString());
            showToast(isDark ? 'Dark mode enabled' : 'Light mode enabled');
        }
        
        // Bookmarks
        function toggleBookmarks() {
            const modal = document.getElementById('bookmarksModal');
            modal.style.display = modal.style.display === 'flex' ? 'none' : 'flex';
            loadBookmarks();
        }
        
        function closeBookmarksModal() {
            document.getElementById('bookmarksModal').style.display = 'none';
        }
        
        function addBookmark() {
            const title = document.querySelector('.chapter-title').textContent;
            const url = window.location.href;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarks') || '[]');
            
            // Check if bookmark already exists
            const exists = bookmarks.find(b => b.url === url);
            if (exists) {
                showToast('Bookmark removed!');
                bookmarks = bookmarks.filter(b => b.url !== url);
            } else {
                showToast('Bookmark saved!');
                bookmarks.push({
                    title: title,
                    url: url,
                    timestamp: new Date().toISOString()
                });
            }
            
            localStorage.setItem('bookmarks', JSON.stringify(bookmarks));
        }
        
        function loadBookmarks() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarks') || '[]');
            const container = document.getElementById('bookmarksList');
            
            if (bookmarks.length === 0) {
                container.innerHTML = '<p>No bookmarks saved.</p>';
                return;
            }
            
            container.innerHTML = bookmarks
                .sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp))
                .map(bookmark => `
                    <div class="bookmark-item">
                        <a href="${bookmark.url}" class="bookmark-link">${bookmark.title}</a>
                    </div>
                `).join('');
        }
        
        // Toast Notifications
        function showToast(message) {
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => toast.classList.add('show'), 100);
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => document.body.removeChild(toast), 300);
            }, 2000);
        }
        
        // Load saved preferences
        window.addEventListener('load', function() {
            // Load font size
            const savedFontSize = localStorage.getItem('fontSize');
            if (savedFontSize) {
                currentFontSize = parseFloat(savedFontSize);
                applyFontSize();
            }
            
            // Load theme
            const isDark = localStorage.getItem('darkMode') === 'true';
            if (isDark) {
                document.body.classList.add('dark-mode');
            }
        });
    </script>
</html>